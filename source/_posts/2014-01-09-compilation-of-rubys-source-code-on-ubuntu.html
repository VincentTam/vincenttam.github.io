---
layout: post
title: Compilation of Ruby's Source Code on Ubuntu
date: 2014-01-09 19:22:00 +0000
categories:
- Linux
- Ruby
tags:
- Ubuntu
published: true
comments: true
---
<p>Oliver's guide has listed the packages on which Ruby depends. Following strictly to the guide, you should start working with the programming language, instead of wasting time to read this article.</p>

<p>Goal: To compile Ruby for whatever reasons.</p>

<p>Background: You've read Oliver's guide. However, your goal does <em>not</em> match with those in <a href="http://excid3.com/blog/setting-up-ubuntu-12-04-with-ruby-1-9-3-nginx-passenger-and-postgresql-or-mysql/">Oliver's guide</a>. Therefore, you <em>don't</em> need to do all the things in the guide and start to skim through the text and to scan for commands useful to you. This is an essential skill to survive in &#042;nix.<sup id="fnref-5-1"><a href="#fn-5-1" rel="footnote">1</a></sup></p>

<p>Problem: You've found <em>some</em> useful commands, and tried working out their dependencies. Nonetheless, you missed out some important commands and thus the dependencies were wrong. Unfortunately, you're unaware of such careless mistake and continued the process, before being stopped by the compiler's error message.</p>

<p>In this case, you found the following commands useful.</p>

<pre class="cli"><code class="ubuntu_gnome_terminal">$ curl
# Substitute [version-number] with that of your downloaded archive.
# If you're NOT sure, use `ls' to list the files inside your folder.
$ tar -xvzf ruby-[version-number].tar.gz
$ cd ruby-[version-number]
$ make
</code></pre>

<p>Therefore, you ran all of these commands. Expecting to get things done and to proceed to the next step, you got an error message from the compiler.</p>

<p>Trial: Using a part of the compiler's error message as the query string a search engine, you get some other web pages on the same or similar topics. If you could find blog entries like this some, they might have links to other similar web pages, so you've got <em>even more</em> to read.</p>

<p>I've found <a href="http://jndistasio.wordpress.com/2012/06/10/installing-ruby-1-9-3-on-opensuse-12-1-openssl-zlib-and-other-problems/">DiStasio's article</a>, which contains a hyperlink to <a href="http://blog.sethladd.com/2007/03/installing-openssl-support-for-ruby-on.html">Ladd's essay</a>. I tried issuing the following commands accroding to the instructions there.</p>

<pre class="cli"><code class="ubuntu_gnome_terminal"># Suppose that the current working directory is the same as the one in the above command list.
# If you're NOT sure, use `pwd' to check it.
$ cd ext/openssl
$ make
$ sudo make reinstall  # I'd installed the wrong version of Ruby.
</code></pre>

<p>Lacking patience to read the blogs, knowledge of using makefiles and experience of compiling softwares from their source code, I don't know how to uninstall the wrong version of Ruby. Are there any <code>make uninstall</code> command?</p>

<p>I tried searching for <code>reinstall</code> and <code>uninstall</code> in the <code>makefile</code>, and failed to find any. Then, I realised that using search engines to answer my questions was inefficient. Reading the official manual of Make <em>wouldn't</em> be effective. Thus, <em>without</em> knowing the truth, I just try the last line of the above list of commands.</p>

<p>The <code>make reinstall</code> command successfully triggered a reinstallation of Ruby, but after running the command, I still received complaints form the compiler. Having <em>no</em> idea on the process, I did the same thing again: copied a part of the message and googled it, and ended up with further more pages to read. The amount of tab pages in my current browser window is too high and this stopped me from opening more web pages on Ruby compilation errors on Google's search result in a new tab.</p>

<p>It took me some time to find out that I overlooked the command below</p> 

<pre class="cli"><code class="ubuntu_gnome_terminal">$ sudo apt-get install build-essential zlib1g-dev libssl-dev libreadline-dev lib
yaml-dev libcurl4-openssl-dev curl git-core python-software-properties
</code></pre>

<p>In Oliver's guide, the above command is right aobve those commands for compiling and installing Ruby. Therefore, I installed them, and tried rebuilding Ruby by running <code>make</code> and <code>sudo make reinstall</code> in my <code>ruby -[version-number]</code>. (i.e. my Ruby source folder) It failed again. <em>Without</em> changing the current working directory directory in the above command list, I did the following because of Ladd's web page.</p>

<pre class="cli"><code class="ubuntu_gnome_terminal">$ make
$ sudo make reinstall
</code></pre>

<p>But it failed again. Maybe I need to go back to <code>ruby-[version-number]</code>, recompile the source code and reinstall Ruby again. So using the <em>same</em> current working directory as the one in the above command list, I did the following thing.</p>

<pre class="cli"><code class="ubuntu_gnome_terminal"><span class="ubuntu_hl_code">$ cd ../..</span> # For changing the current working directory to `ruby-[version-number]'.
$ make
$ sudo make reinstall
</code></pre>

<p>Things still went wrong! I remembered the <code>make clean</code> command, so <em>without</em> changing the current working directory, I ran the following commands.</p>

<pre class="cli"><code class="ubuntu_gnome_terminal">$ make clean
$ make
$ sudo make reinstall
</code></pre>

<p>Remark: With the command <code>dkpg -l | grep ruby</code>, I realised that <code>make clean</code> <em>doesn't</em> uninstall Ruby. It just deletes all compiled files in <code>ruby -[version-number]</code>.</p>

<p>It still <em>wouldn't</em> compile with the OpenSSL feature. However, some features that had failed to compile before I had run the command <code>make clean</code> could be compiled.</p>

<p>This inspired me to run the following commands.</p>

<pre class="cli"><code class="ubuntu_gnome_terminal">$ cd ext/openssl
$ make clean
$ make
$ sudo make reinstall
</code></pre>

However, I still got errors. There was a problem in getting the file <code>ossl.o</code> work. (I've forgotten the exact name of that file, and I <em>couldn't</em> find web pages about the same error.) I ignored the message and ran the following commands.<br />

<pre class="cli"><code class="ubuntu_gnome_terminal">$ cd ../..
$ make clean
$ make
$ sudo make reinstall
</code></pre>

<p>But it still <em>didn't</em> go right. After running the commands <code>make</code> and <code>make clean</code> for a number of times, I eventually worked out a solution for my problem.</p>

<p>Solution:</p>

<ol>
    <li>Run the command <code>make clean</code> in <em>both</em> the <code>ruby-[version-number]</code> and <code>ruby-[version-number]/ext/openssl</code> directories.</li>
    <li>Run <code>make</code> in <code>ruby-[version-number]</code> to compile the source code. Some errors like "Failed to compile gdbm" will come out. It depends on your needs. Having <em>no</em> clue on what <code>gdbm</code> is, I just proceed to the reinstallation of Ruby.<br /></li>
    <li>Run the command <code>sudo make reinstall</code> in <code>ruby-[version-number]</code>. Then the command <code>gem install bundle</code> in Oliver's guide should work.</li>
</ol>

<p>Lessons learnt:</p>

<ol>
    <li>Always figure out the dependencies of a package.<br /></li>
    <li>Be careful and patient while reading instructions on commands.<br /></li>
    <li>Always clear <em>all</em> compiled files before any recompilation.</li>
</ol>

<p>Posted via <a href="http://0x3f.org/blog/ultrablog-as-an-ultimate-vim-blogging-plugin/">UltraBlog.vim</a>.</p>

<div class="footnotes">
<hr />
<ol>

<li id="fn-5-1">
<a href="http://user.frdm.info/ckhung/a/c013.php">如何有效學習電腦</a>&#160;<a href="#fnref-5-1" rev="footnote">&#8617;</a>
</li>

</ol></div>
