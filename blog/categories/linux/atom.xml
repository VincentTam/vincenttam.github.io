<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Linux | Blog 1]]></title>
  <link href="https://vincenttam.github.io/blog/categories/linux/atom.xml" rel="self"/>
  <link href="https://vincenttam.github.io/"/>
  <updated>2015-09-03T22:49:14+08:00</updated>
  <id>https://vincenttam.github.io/</id>
  <author>
    <name><![CDATA[Vincent Tam]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    
      <title type="html"><![CDATA[Rare Sed Delimiters]]></title>
      <link href="https://vincenttam.github.io/blog/2015/08/25/rare-sed-delimiters/"/>
    
    <updated>2015-08-25T10:47:53+08:00</updated>
    <id>https://vincenttam.github.io/blog/2015/08/25/rare-sed-delimiters</id>
    
      <content type="html"><![CDATA[<h2 id="background">Background</h2>

<p>One can replace the usual delimiter <code>/</code> in <code>sed</code> with the other ones.
Therefore, the slashes in the <abbr title="Uniform Resource Locator">URL</abbr> inside the search pattern <em>won’t</em>
have to be escaped by backslashes, which makes the whole command ugly.</p>

<h2 id="problem">Problem</h2>

<p>If the search pattern contains multiple characters like <code>;</code>, <code>#</code>, <code>|</code>,
` `, etc, and you’re <em>too lazy</em> to look for
<a href="http://backreference.org/2010/02/20/using-different-delimiters-in-sed/">other choices of delimiters</a>, what can you do?</p>

<!-- more -->

<h2 id="discussion-on-the-custom-delimiter">Discussion on the custom delimiter</h2>

<p>When I read article at the above link, I was stuck at the last part,
which was about using a custom delimiter.  I <em>mistakenly</em> thought that
this was for the search pattern and the replacement.  In fact, reading
<a href="https://www.gnu.org/software/sed/manual/html_node/Addresses.html#Addresses">GNU’s manual</a> and trying some commands repeatedly, I realized
that prepending the custom delimiter with a backslash was for
specifying the range of the following expresion.</p>

<p>Therefore, I finally understand what <code>somevar</code> is in
<a href="http://stackoverflow.com/a/20808364">this Stack Overflow question</a>.</p>

<h2 id="solution">Solution</h2>

<h3 id="customizing-the-delimiter-in-a-replacement">Customizing the delimiter in a replacement</h3>

<p>To begin with, I tried the following command.</p>

<pre class="cliUB"><code>$ echo strange | sed s/'[a-e]'/#/g
str#ng#
</code></pre>

<p>After that, I know that surrounding the whole <code>s</code> command <em>isn’t</em> a
must, just the <code>regex</code> and <code>replacement</code> will do.</p>

<p>Then I replaced all <code>/</code> with <code>y</code> in the above command.</p>

<pre class="cliUB"><code>$ echo strange | sed sy'[a-e]'y#yg
str#ng#
</code></pre>

<p>Now, it’s clear that the custom delimiter in the <code>s</code> command <em>doesn’t</em>
need to be escaped.</p>

<h3 id="towards-the-goal">Towards the goal</h3>

<p>The goal in this post is to use bizarre characters as the delimiter in
the <code>s</code> command, and I believe that if you’ve reached here, you’ll
probably understand what <a href="https://stackoverflow.com/a/4844945">this command</a> is doing, provided
that you know the way to
<a href="https://stackoverflow.com/a/10571642">input control characters as arguments in bash commands</a>.</p>

<h2 id="more-examples">More examples</h2>

<p>I’ve just tried to delete a <code>&lt;script&gt;</code> tag in the <code>master</code> branch of a
repository for <a href="https://vincenttam.github.io/SampleWebPage/ex0.html">my sample W3CSS page</a> using the in-place
editing option of <code>sed</code>.  Before making <em>real</em> changes to the file, I
tested my command syntax with the standard output first.</p>

<pre class="cliUB"><code>[owner@localhost ~/SampleWebPage]$ git branch -a
* master
  remotes/origin/HEAD -&gt; origin/master
  remotes/origin/gh-pages
  remotes/origin/master
[owner@localhost ~/SampleWebPage]$ sed -nr '\#&lt;scr#,#&lt;/scr#p' ex0.html
sed: -e expression #1, char 9: unexpected `,'
</code></pre>

<p>Looking at <a href="https://www.gnu.org/software/sed/manual/html_node/Addresses.html#Addresses">the manual</a> <em>again</em>, I thought that <code>\%regex%</code>
represented <em>one</em> address only.  The pattern after the comma was
<em>another</em> address, so I should have used <em>two</em> backslashes in the last
command.</p>

<pre class="cliUB"><code>[owner@localhost ~/SampleWebPage]$ sed -ir '\#&lt;scr#,\#&lt;/scr#' ex0.html
</code></pre>

]]></content>
    
  </entry>
  
  <entry>
    
      <title type="html"><![CDATA[Find Files for Vim to Edit in Bash]]></title>
      <link href="https://vincenttam.github.io/blog/2015/08/23/find-files-for-vim-to-edit-in-bash/"/>
    
    <updated>2015-08-23T23:48:54+08:00</updated>
    <id>https://vincenttam.github.io/blog/2015/08/23/find-files-for-vim-to-edit-in-bash</id>
    
      <content type="html"><![CDATA[<h2 id="background">Background</h2>

<p>Since copying and pasting the output of a command can be a tedious
job.  For example, if you want to create your blog using a framework,
you may first logon to your <a href="https://github.com">GitHub</a> account and create an <em>empty</em>
repository there, then <code>git clone</code> <a href="http://octopress.org">Octopress</a>/<a href="http://jekyllbootstrap.com">Jekyll-Bootstrap</a> from
GitHub, reset the <code>origin</code> <abbr title="Uniform Resource Locator">URL</abbr>, and input the new <abbr title="Uniform Resource Locator">URL</abbr> based on the old
one.</p>

<p>After having created a repository online, you will see the <abbr title="Uniform Resource Locator">URL</abbr> of the
repository using the <abbr title="Secure SHell">SSH</abbr> protocol.  If one <em>doesn’t</em> want to repeat
the start of the <abbr title="Uniform Resource Locator">URL</abbr> <code>git@github.com:</code>, one may use the bash commands
introduced in <a href="/blog/2015/08/22/used-more-bash-utilities/">the previous post</a> to extract its useful parts for
the <code>sed</code> substitution.</p>

<pre class="cliUB"><code>$ git remote -v
octopress	git@github.com:imathis/octopress.git (fetch)
octopress	git@github.com:imathis/octopress.git (push)
origin	git@github.com:VincentTam/vincenttam.github.io.git (fetch)
origin	git@github.com:VincentTam/vincenttam.github.io.git (push)
$ name=userName; repo=repoName
$ git remote -v | sed -n '3{p;q}' | awk '{print $2}' | sed -r \
"s;(\w*)/(.*).git;$name/$repo.git;"
$ unset name repo
</code></pre>

<h2 id="problem">Problem</h2>

<p>I tried extracting a list of Markdown files containing a particular
word and passing them to <a href="http://www.vim.org">Vim</a> as arguments using <code>find</code>, <code>grep</code> and
<code>xargs</code>.  Unluckily, I got an error.</p>

<pre class="cliUB"><code>$ find source/_posts/ -name "*.markdown" -exec grep -q ^tag {} \; \
&gt; -print | xargs vi
Vim: Warning: Input is not from a terminal
3 files to edit
$ 
</code></pre>

<p>Note: <em>Without</em> the <code>-print</code> flag, the above command <em>won’t</em> work.</p>

<!-- more -->

<h2 id="solution">Solution</h2>

<p>As a result, I searched “vim warning input is not from a terminal
xargs” on Google, and found <a href="http://superuser.com/q/336016">this question</a> very useful.  I
should have wrapped the <code>find</code> command like <code>$(find ...)</code>.</p>

<pre class="cliUB"><code>$ vi $(find source/_posts/ -name "*.markdown" -exec \
&gt; grep -q ^tag {} \; -print | xargs)
3 files to edit
</code></pre>

<h2 id="facts-learnt">Facts learnt</h2>

<h3 id="sed">sed</h3>
<ul>
  <li><code>3{p;q}</code>: quit after printing the third line for the sake of
  efficiency</li>
  <li><code>-r</code>: use extended regular expression to save the trouble of
  escaping <code>()</code> for submatches.</li>
  <li><code>-n</code>: suppress standard output.</li>
  <li>Enclose the expression
    <ul>
      <li>with <em>single</em> quotes to <em>disable</em> interpretation of bash
  variables</li>
      <li>with <em>double</em> quotes to <em>enable</em> interpretation of bash
  variables.</li>
    </ul>
  </li>
  <li>One can replace the delimiter <code>/</code> in the expression
  <code>s/{pat}/{repl}/</code> by any one character from <code>_;#| </code>.</li>
  <li>Specify a custom delimiter like <code>\%.%s%foo%bar%</code>.  (The
  variable/range <code>.</code> is <em>needed</em>.)</li>
</ul>

<h3 id="bash">bash</h3>

<ul>
  <li>Set variables using <code>var1=value1;var2=value2;...</code></li>
  <li>Unset variable usign <code>unset var1 var2 ...</code></li>
</ul>

]]></content>
    
  </entry>
  
  <entry>
    
      <title type="html"><![CDATA[Used More Bash Utilities]]></title>
      <link href="https://vincenttam.github.io/blog/2015/08/22/used-more-bash-utilities/"/>
    
    <updated>2015-08-22T11:59:26+08:00</updated>
    <id>https://vincenttam.github.io/blog/2015/08/22/used-more-bash-utilities</id>
    
      <content type="html"><![CDATA[<h2 id="background">Background</h2>

<p>Same as what has been written in my older post
<a href="/blog/2014/12/12/using-xclip/"><em>Using Xclip</em></a>.</p>

<h2 id="drawback">Drawback</h2>

<p>Inputing the keyboard command for the paste action is, in my opinion,
<em>laborious</em>.</p>

<h2 id="tools-used">Tools used</h2>

<ol>
  <li><code>find</code></li>
  <li><code>grep</code></li>
  <li><code>sed</code></li>
  <li><code>awk</code></li>
  <li><code>xargs</code></li>
</ol>

<!-- more -->

<h3 id="the-find-command">The find command</h3>

<pre class="cliUB"><code>find . -path ./dir -prune -o -name '*.txt' -type f -print
find ./foo -exec wc {} \;
</code></pre>

<ul>
  <li><code>-path ./dir -prune -o</code>: exclude the directory <code>./dir</code></li>
  <li><code>-name '*.txt'</code>: match the name of the file</li>
  <li><code>-type f</code>: match files only, not directories</li>
  <li><code>-print</code>: print all matched paths</li>
  <li><code>-exec {cmd} {} \;</code>
    <ul>
      <li>execute <em>one single</em> command <code>{cmd}</code>, no pipes are allowed</li>
      <li><code>{}</code>: an instance of matched path</li>
      <li><code>\;</code>: terminator</li>
    </ul>
  </li>
</ul>

<p>I’ve found that if <code>-type f</code> goes <em>before</em> <code>-path ./dir -prune -o</code>,
the path <code>./dir</code> <em>won’t</em> be excluded.  <strong>Don’t use <code>./</code>, use <code>.</code>!</strong> on
Mac.</p>

<p>Using <code>-not -path ./dir</code> option <em>doesn’t</em> work.</p>

<h3 id="the-grep-command">The grep command</h3>

<ul>
  <li><code>-I</code>: ignore binary files</li>
  <li><code>-q . {}</code>: match any characters and suppress output for faster
  execution</li>
</ul>

<h3 id="the-sed-command">The sed command</h3>

<ul>
  <li><code>-i .bak</code>: edit file with backup extension <code>.bak</code> (Mac only, not in
  *nix)</li>
  <li><code>-i ''</code>: no backup (Also Mac only)</li>
  <li><code>sed 'p;s/foo/bar/'</code>: print original and replaced strings, separated
by whitespace.</li>
</ul>

<h3 id="the-awk-command">The awk command</h3>

<p>The command <code>awk '{ print $2 }'</code> extracts the second column.  For more
examples, see <a href="http://www.hcs.harvard.edu/~dholland/computers/awk.html">the simple awk tutorial</a>.</p>

<h3 id="the-xargs-command">The xargs command</h3>

<p>This is a very powerful command when combined with <code>find</code>.  This
utility reads from <code>stdin</code> and echos it.</p>

<ul>
  <li>no flags: all output joined into a single line</li>
  <li><code>-n3</code>: 3 space-delimited stdin in each line</li>
  <li><code>xargs -n2 {cmd}</code>: execute <code>{cmd} {arg1} {arg2}</code>, …, <code>{cmd}
  {arg2n-1} {arg2n}</code>.</li>
</ul>

<h3 id="putting-things-together">Putting things together</h3>

<p>Here’s some sample commands.</p>

<h4 id="find-and-replace-for-all-text-files-under-a-path">Find and replace for all text files under a path</h4>

<pre class="cliUB"><code>find . -path ./.git -prune -o -type f -exec grep -Iq . {} \; -and \
-exec sed -i 's/foo/bar/g' {} \;
</code></pre>

<p>Ignore the <code>.git</code> folder, which is the Git repository, to avoid
damaging it.</p>

<h4 id="find-and-replace-substrings-in-path-names">Find and replace substrings in path names</h4>

<pre class="cliUB"><code>find . -path ./.git -prune -o -name "*foo*" -print | sed \
'p;s/foo/bar/g' | xargs -n2 mv
</code></pre>

<p>All instances of <code>foo</code> in path names are replaced with <code>bar</code>.  Note
that that <code>-print</code> option <em>should be included</em>.  Otherwise, the path
<code>./.git</code> which is intended to be omitted will appear in the piped
output and processed by <code>sed</code>, and then the terminal will throw the
follow error message.</p>

<pre class="cliUB"><code>fatal: can not move directory into itself, source=.git, destination=.git/.git
</code></pre>

<h4 id="find-and-replace-git-remote-paths">Find and replace Git remote paths</h4>

<pre class="cliUB"><code>$ git remote -v | awk '{ print $2 }' | head -1 | \
xargs git remote set-url origin
$ git remote -v
origin	https://github.com/VincentTam/StudentList1.git (fetch)
origin	https://github.com/VincentTam/StudentList1.git (push)
$ git remote -v | awk '{ print $2 }' | head -1 | sed \
's/StudentList1/StudentList4/' | xargs git remote set-url origin
$ git remote -v
origin	https://github.com/VincentTam/StudentList4.git (fetch)
origin	https://github.com/VincentTam/StudentList4.git (push)
</code></pre>

]]></content>
    
  </entry>
  
  <entry>
    
      <title type="html"><![CDATA[Upgrade to Java 8 on Ubuntu 14.04]]></title>
      <link href="https://vincenttam.github.io/blog/2015/08/13/upgrade-to-java-8-on-ubuntu-14-dot-04/"/>
    
    <updated>2015-08-13T00:14:01+08:00</updated>
    <id>https://vincenttam.github.io/blog/2015/08/13/upgrade-to-java-8-on-ubuntu-14-dot-04</id>
    
      <content type="html"><![CDATA[<h2 id="background">Background</h2>

<p>Before writing <a href="/blog/2015/08/12/debug-apps-on-real-devices-in-android-studio/">the previous post</a>, I had noticed that the version
number of the current stable release of Java is 1.8 update 51.</p>

<h2 id="method">Method</h2>

<ol>
  <li>Google “ubuntu 14.04 java 8”.</li>
  <li>Click on <a href="http://tecadmin.net/install-oracle-java-8-jdk-8-ubuntu-via-ppa/">the first search result</a>.</li>
  <li>
    <p>Follow the instructions there.</p>

    <p>Note that the command in the section “Configuring Java
 Environment” should be run <em>before</em> the one in “Verify Installed
 Java Version”.<sup id="fnref:result"><a href="#fn:result" class="footnote">1</a></sup></p>
  </li>
</ol>

<h2 id="lessons-learnt">Lessons learnt</h2>

<p><a href="https://www.linuxquestions.org/questions/programming-9/convert-file-from-utf8-to-ascii-encoding-458839/">The encoding of files can be converted</a> using <code>iconv</code>.</p>

<hr />

<div class="footnotes">
  <ol>
    <li id="fn:result">
      <p>You may see <a href="/downloads/code/term.html">the results from the terminal</a>. <a href="#fnref:result" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>
]]></content>
    
  </entry>
  
  <entry>
    
      <title type="html"><![CDATA[Git Object ID Generation (5): Predict ID]]></title>
      <link href="https://vincenttam.github.io/blog/2015/08/11/git-object-id-generation-5-predict-id/"/>
    
    <updated>2015-08-11T10:52:56+08:00</updated>
    <id>https://vincenttam.github.io/blog/2015/08/11/git-object-id-generation-5-predict-id</id>
    
      <content type="html"><![CDATA[<h2 id="goal">Goal</h2>

<p>The method for getting the Git object ID described in
<a href="/blog/2015/08/07/git-object-id-generation-4-general-trees/">previous post in this series</a> <em>isn’t</em> quick enough since it
consists of <em>several</em> commands.</p>

<h2 id="the-one-line-command">The one-line command</h2>

<h3 id="objects-with-known-git-id">Objects with known Git ID</h3>

<pre class="cliUB"><code>$ (printf "{obj_type} $(git cat-file -s {hash})\0" &amp;&amp; git cat-file {obj_type} {h
ash}) | shasum
</code></pre>

<ul>
  <li><code>{obj_type}</code> can be <code>blob</code>, <code>tree</code>, <code>commit</code> or <code>tag</code>.</li>
  <li><code>{hash}</code> is the SHA-1 hash of the object.</li>
</ul>

<p>Then the output SHA-1 hash should be the <em>same</em> as the input <code>{hash}</code>.</p>

<h3 id="predict-git-object-ids">Predict Git object IDs</h3>
<p>Hence, we can modify the above command to predict the Git object ID of
a <code>{file}</code>.</p>

<pre class="cliUB"><code>$ (printf "{obj_type} $(wc -c {file} | tr -dc '0-9')\0" &amp;&amp; cat {file}) | shasum
</code></pre>

<p>In order to verify the result for files, one can quickly get the blob
ID from Git by <code>git log -1 -p -- {file}</code>.</p>

<h2 id="facts-learnt">Facts learnt</h2>

<h2 id="extract-numbers-from-a-string-in-bash">Extract numbers from a string in bash</h2>

<p>I typed “linux extract number” on Google, and the autocompletion gave
me “from string”.  I finally saw two commands for doing this.</p>

<ol>
  <li><code>sed 's/[^0-9]//g'</code></li>
  <li><code>tr -dc '0-9'</code></li>
</ol>

<p>In my opinion, the later is simpler.  The <code>-c</code> flag takes the
complement of the characters marked by <code>-d</code>.</p>

<h3 id="using-cat-on-m-win">Using cat on M$ Win*</h3>

<p>Using the command in the section “Predict Git object IDs” gives users
a <em>wrong</em> SHA-1 sum.  The reason is that M$ Win* uses <code>\r\n</code> instead
of <code>\n</code> for starting newlines.  This also results in the <em>incorrect</em>
byte count of the files with <code>\r\n</code> as the line terminator in that
command.  Thus, the extra <code>\r</code> needs to be deleted with <code>tr -d '\r'</code>.</p>

<h3 id="using-git-for-win">Using Git for Win*</h3>

<p>For the installed version of Git on M$ Win*, one needs to use
<code>sha1sum</code> instead of <code>shasum</code>.  Otherwise, Git Bash will complain that
it is “Unable to find Digest::SHA or Digest::SHA::PurePerl”.</p>

<h3 id="using-gitportable-on-m-win">Using GitPortable on M$ Win*</h3>

<p>Since one <em>can’t</em> even issue the command <code>sha1sum</code>, use <code>openssl sha1</code>
instead.  (Omitting the trailing <code>1</code> will result in a <em>very different</em>
hexadecimal number.)</p>

]]></content>
    
  </entry>
  
</feed>
