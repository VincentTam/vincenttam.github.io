<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Octopress | Blog 1]]></title>
  <link href="https://vincenttam.github.io/blog/categories/octopress/atom.xml" rel="self"/>
  <link href="https://vincenttam.github.io/"/>
  <updated>2015-05-30T22:19:18+08:00</updated>
  <id>https://vincenttam.github.io/</id>
  <author>
    <name><![CDATA[Vincent Tam]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    
      <title type="html"><![CDATA[Set Up Another Local Repository for an Existing Octopress Blog]]></title>
      <link href="https://vincenttam.github.io/blog/2015/03/09/set-up-another-local-repository-for-an-existing-octopress-blog/"/>
    
    <updated>2015-03-09T15:17:20+08:00</updated>
    <id>https://vincenttam.github.io/blog/2015/03/09/set-up-another-local-repository-for-an-existing-octopress-blog</id>
    
      <content type="html"><![CDATA[<h2 id="motivation">Motivation</h2>

<p>Same as the raison d’être in <a href="/blog/2014/05/26/using-octopress-on-another-device/#raison-dtre"><em>Using Octopress on Another Device</em></a>
in Blog 1.</p>

<h2 id="problem">Problem</h2>

<p>When I wrote that post last year, I gave <em>too little</em> commands for the
actual process of setting up the local repository.  Yesterday, I
re-read <a href="http://blog.zerosharp.com/clone-your-octopress-to-blog-from-two-places/">Robert Anderson’s post</a> again, and tried reproducing the
steps, and got some redundant Git branches.</p>

<!-- more -->

<h2 id="my-steps">My steps</h2>

<p>Assume that throughout this post, the current working directoy is
<code>~/octopress</code>.</p>

<pre class="cliUB"><code>$ pwd
/home/owner/octopress
$ git clone -b source git@github.com:VincentTam/vincenttam.github.io.git .
Cloning into '.'...
remote: Counting objects: 71346, done.
remote: Compressing objects: 100% (76/76), done.
remote: Total 71346 (delta 8), reused 0 (delta 0), pack-reused 71266
Receiving objects: 100% (71346/71346), 63.71 MiB | 3.08 MiB/s, done.
Resolving deltas: 100% (33764/33764), done.
Checking connectivity... done.
</code></pre>

<p>This is a standard command, and I first created the folder
<code>~/octopress</code> before cloning the <code>source</code> branch to the folder, so
that my commands <em>aren’t</em> exactly the same as Anderson’s.</p>

<p>To make another difference, I also fetched the <code>master</code> branch from
Octopress.</p>

<pre class="cliUB"><code>$ git remote add octopress git@github.com:imathis/octopress.git
$ git fetch octopress master
From github.com:imathis/octopress
 * branch            master     -&gt; FETCH_HEAD
 * [new branch]      master     -&gt; octopress/master
$ git branch -av
* source                   bd39cb2 Corrected the MathJax syntax for X ~ Exp(λ)
  remotes/octopress/master 5080107 Fixed improper canonical url
  remotes/origin/HEAD      -&gt; origin/source
  remotes/origin/master    7f8f845 Site updated at 2015-03-08 12:59:04 UTC
  remotes/origin/source    bd39cb2 Corrected the MathJax syntax for X ~ Exp(λ)
</code></pre>

<p>Since I <em>dont’t</em> and <em>won’t</em> have a Mac laptop, I <em>skipped</em> the
command <code>rbenv rehash</code>.</p>

<picture class="fancybox" title="A Macbook exploded">
  <source srcset="/images/posts/MacExplosion/MacExplosion.jpg" media="(min-width: 340px)" />
  <img alt="Macbook exploded" src="https://vincenttam.github.io/images/posts/MacExplosion/MacExplosion300.jpg" />
</picture>

<p><small>Source:
<a href="http://www.homelandsecureit.com/wp-content/uploads/2011/07/MacExplosion.jpg">http://www.homelandsecureit.com/wp-content/uploads/2011/07/MacExplosion.jpg</a>
</small></p>

<p>I then viewed the task <code>setup_github_pages</code> in <code>Rakefile</code>, and
discovered that if I cloned the whole remote repository of the
Octopress blog into <code>_deploy</code>, the there’d be an extra <code>master</code> branch
in the default deploy directory.  To avoid this, I typed a longer
command.</p>

<pre class="cliUB"><code>$ gem install bundler
$ bundle install
$ git clone git@github.com:VincentTam/vincenttam.github.io.git -b master _deploy
Cloning into '_deploy'...
remote: Counting objects: 71346, done.
remote: Compressing objects:  68% (52/76)   Receiving objects:   0% (1/71346)
remote: Compressing objects: 100% (76/76), done.
remote: Total 71346 (delta 8), reused 0 (delta 0), pack-reused 71266
Receiving objects: 100% (71346/71346), 63.71 MiB | 2.77 MiB/s, done.
Resolving deltas: 100% (33764/33764), done.
Checking connectivity... done.
Checking out files: 100% (644/644), done.
$ cd _deploy &amp;&amp; git branch -av &amp;&amp; cd ..
* master                7f8f845 Site updated at 2015-03-08 12:59:04 UTC
  remotes/origin/HEAD   -&gt; origin/source
  remotes/origin/master 7f8f845 Site updated at 2015-03-08 12:59:04 UTC
  remotes/origin/source bd39cb2 Corrected the MathJax syntax for X ~ Exp(λ)
</code></pre>

<p>To test if the last two words of the command in Anderson’s post could
be <em>omitted</em>, I <em>changed</em> the Markdown source of one of my old posts
slightly, committed the change and pushed it to GitHub.</p>

<pre class="cliUB"><code>$ gvim source/_posts/2014-03-16-latex-template-for-essays.markdown
$ git commit -am "Another small minor change" &amp;&amp; git push
[source 4be7fba] Another small minor change
1 file changed, 2 insertions(+), 4 deletions(-)
Counting objects: 10, done.
Delta compression using up to 4 threads.
Compressing objects: 100% (5/5), done.
Writing objects: 100% (5/5), 435 bytes | 0 bytes/s, done.
Total 5 (delta 4), reused 0 (delta 0)
To git@github.com:VincentTam/vincenttam.github.io.git
bd39cb2..4be7fba  source -&gt; source
$ cd _deploy/ &amp;&amp; git branch -av &amp;&amp; cd ..
* master		7f8f845 Site updated at 2015-03-08 12:59:04 UTC
  remotes/origin/HEAD   -&gt; origin/source
  remotes/origin/master 7f8f845 Site updated at 2015-03-08 12:59:04 UTC
  <span class="HLCode">remotes/origin/source bd39cb2 Corrected the MathJax syntax for X ~ Exp(λ)</span>
$ cd _deploy/ &amp;&amp; <span class="HLCode">git pull</span> &amp;&amp; git branch -av &amp;&amp; cd ..
* master		7f8f845 Site updated at 2015-03-08 12:59:04 UTC
  remotes/origin/HEAD   -&gt; origin/source
  remotes/origin/master 7f8f845 Site updated at 2015-03-08 12:59:04 UTC
  <span class="HLCode">remotes/origin/source 4be7fba Another small minor change</span>
</code></pre>

<p>From <code>Rakefile</code> and the above highlighted command output, I could
deduce that before starting to blog on another machine and publish
them to GitHub Pages, one needed to pull the commits from the remote
repository by <code>git pull origin source</code> and <code>git pull</code> in <code>~/octopress</code>
and <code>~/octopres/_deploy</code> respectively.</p>

<p>Then I faced the same errors I saw yesterday.<sup id="fnref:pp2"><a href="#fn:pp2" class="footnote">1</a></sup>  After solving
them, I proceeded to deploying the site to GitHub Pages.</p>

<pre class="cliUB"><code>$ rake deploy

...

 30 files changed, 44 insertions(+), 46 deletions(-)

## Pushing generated _deploy website
Counting objects: 130, done.
Delta compression using up to 4 threads.
Compressing objects: 100% (64/64), done.
Writing objects: 100% (65/65), 5.37 KiB | 0 bytes/s, done.
Total 65 (delta 35), reused 0 (delta 0)
To git@github.com:VincentTam/vincenttam.github.io.git
   7f8f845..5af7b9d  master -&gt; master

## Github Pages deploy complete
cd -
</code></pre>

<p>Lastly, I found that the remote tracking branch <code>origin/master</code>
<em>wasn’t</em> necessary in <code>~/octopress</code>.  However, the creation of this
branch <em>couldn’t</em> be avoided: using <code>git clone</code> to clone either the
<em>whole repository</em> or <em>a single branch only</em> will lead the creation of
<em>all</em> remote branches.  To minimize the number of branches in the
local repository for an Octopress blog, I suggest deleting the
outdated <code>origin/master</code> branch.</p>

<pre class="cliUB"><code>$ cd _deploy &amp;&amp; git branch -av &amp;&amp; cd ..
<span class="HLCode">* master                5af7b9d Site updated at 2015-03-09 06:54:16 UTC</span>
  remotes/origin/HEAD   -&amp;gt; origin/source
  <span class="HLCode">remotes/origin/master 5af7b9d Site updated at 2015-03-09 06:54:16 UTC</span>
  remotes/origin/source 4be7fba Another small minor change
$ git branch -av
* source                   4be7fba Another small minor change
  remotes/octopress/master 5080107 Fixed improper canonical url
  remotes/origin/HEAD      -&amp;gt; origin/source
  <span class="HLCode">remotes/origin/master    7f8f845 Site updated at 2015-03-08 12:59:04 UTC</span>
  remotes/origin/source    4be7fba Another small minor change
$ git branch -rd origin/master
Deleted remote branch origin/master (was 7f8f845).
</code></pre>

<hr />

<div class="footnotes">
  <ol>
    <li id="fn:pp2">
      <p>See <a href="/blog/2015/03/08/another-jekyll-error/"><em>Another Jekyll Error</em></a> in Blog 1 for details. <a href="#fnref:pp2" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>
]]></content>
    
  </entry>
  
  <entry>
    
      <title type="html"><![CDATA[Another Jekyll Error]]></title>
      <link href="https://vincenttam.github.io/blog/2015/03/08/another-jekyll-error/"/>
    
    <updated>2015-03-08T17:08:53+08:00</updated>
    <id>https://vincenttam.github.io/blog/2015/03/08/another-jekyll-error</id>
    
      <content type="html"><![CDATA[<h2 id="problem">Problem</h2>

<p>Markdown encountered an error when I ran <code>rake generate</code>.</p>

<pre class="cliUB"><code>$ rake generate &amp;&amp; rake preview
## Generating Site with Jekyll
    write source/stylesheets/screen.css
Configuration file: /home/owner/octopress/_config.yml
            Source: source
       Destination: public
      Generating... 
  Conversion error: Jekyll::Converters::Markdown encountered an error while conv
erting '_posts/2014-01-31-comparison-of-latexs-quote-and-quotation-environments.
markdown/#excerpt':
                    "\xC2" from ASCII-8BIT to UTF-8
jekyll 2.5.3 | Error:  "\xC2" from ASCII-8BIT to UTF-8
Starting to watch source with Jekyll and Compass. Starting Rack on port 4000
Configuration file: /home/owner/octopress/_config.yml
[2015-03-08 15:49:51] INFO  WEBrick 1.3.1
[2015-03-08 15:49:51] INFO  ruby 2.1.2 (2014-05-08) [i686-linux]
[2015-03-08 15:49:51] INFO  WEBrick::HTTPServer#start: pid=5560 port=4000
&gt;&gt;&gt; Compass is watching for changes. Press Ctrl-C to Stop.
directory public/stylesheets
    write public/stylesheets/print.css
            Source: source
       Destination: public
      Generating... 
    write public/stylesheets/screen.css
  Conversion error: Jekyll::Converters::Markdown encountered an error while conv
erting '_posts/2014-04-05-latex-template-for-chinese-essays.markdown/#excerpt':
                    "\xE6" from ASCII-8BIT to UTF-8
jekyll 2.5.3 | Error:  "\xE6" from ASCII-8BIT to UTF-8
</code></pre>

<!-- more -->

<h2 id="discussion">Discussion</h2>

<p>I feel that this problem is similar to the YAML error which I
encountered last year.<sup id="fnref:pp_yaml"><a href="#fn:pp_yaml" class="footnote">1</a></sup>  However, I had <em>already</em> added the
line <code>encoding: UTF-8</code> to <code>_config.yml</code>, and when I opened the file
with Vim, I saw, from <code>:se fenc</code> and <code>:se enc</code> that the encoding was
UTF-8.</p>

<p>I googled “incompatible character encodings utf-8 and ascii-8bit
octopress” and clicked the first result, which was an article written
in 2013.<sup id="fnref:chin1"><a href="#fn:chin1" class="footnote">2</a></sup>  According to the blog post, I opened
<code>:~/.rvm/gems/ruby-2.1.2/gems/jekyll-2.5.3/lib/jekyll/converters/markdown.rb</code>,
but I <em>couldn’t</em> find line 120 because I’m now using Ruby 2.1.2 and
Jekyll 2.5.3.</p>

<p>Though the steps mentioned in another blog posts found were the same,
from the first paragraph of that post, I knew that the cause was the
embedded Gists in Octopress posts/pages.<sup id="fnref:chin2"><a href="#fn:chin2" class="footnote">3</a></sup></p>

<h2 id="resolution">Resolution</h2>

<p>I continued viewing other Google search results, and discovered a
single question on two different sites.  That question was actually a
Stack Overflow question which had two responses.<sup id="fnref:so16264160"><a href="#fn:so16264160" class="footnote">4</a></sup>  The
second one seemed to solve my problem.</p>

<p>I googled “vim remove bom”, and found another web page.<sup id="fnref:vim_bom"><a href="#fn:vim_bom" class="footnote">5</a></sup>
Later, I realised that I could find the information using <code>:h bom</code>.  I
typed <code>:se nobomb</code> in the affected files, and Rake could finally
generate the site.</p>

<hr />

<div class="footnotes">
  <ol>
    <li id="fn:pp_yaml">

      <p>See <a href="/blog/2014/06/04/resolving-jekylls-yaml-exception/"><em>Resolving Jekyll’s YAML Exception</em></a> in Blog 1 for
details. <a href="#fnref:pp_yaml" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:chin1">

      <p><a href="http://blog.txx.im/blog/2013/08/25/octopress-utf-8-ascii-8bit-conflict-error/"><em>Octopress 上的 utf-8和ASCII-8BIT 冲突的解决方案</em></a> in
txx’s blog <a href="#fnref:chin1" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:chin2">

      <p><a href="http://lenciel.cn/2014/05/fix-gist-style-in-octopress/"><em>Octopress里插入带中文Gist的问题和解决</em></a> @Lenciel <a href="#fnref:chin2" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:so16264160">

      <p><a href="https://stackoverflow.com/a/25228668">Unicode weirdness with octopress, kramdown, and Heroku</a> on Stack
Overflow <a href="#fnref:so16264160" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:vim_bom">

      <p><a href="http://www.santiagolizardo.com/article/remove-bom-mark-from-files-with-vim"><em>Remove BOM mark from files with VIM</em></a> by Santiago
Lizardo. <a href="#fnref:vim_bom" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>
]]></content>
    
  </entry>
  
  <entry>
    
      <title type="html"><![CDATA[Code Blocks in Octopress Atom Feeds]]></title>
      <link href="https://vincenttam.github.io/blog/2015/02/14/code-blocks-in-octopress-atom-feeds/"/>
    
    <updated>2015-02-14T19:20:37+08:00</updated>
    <id>https://vincenttam.github.io/blog/2015/02/14/code-blocks-in-octopress-atom-feeds</id>
    
      <content type="html"><![CDATA[<h2 id="problem">Problem</h2>

<p>After I re-generated this site, it is <em>possible</em> that the code blocks
and the <em>pictures</em> in the <abbr title="Rich Site Summary">RSS</abbr> feeds are <em>gone</em>.</p>

<p><figure class='code'><figcaption><span>WRONG version of C/C++ category feed</span><a href='http://goo.gl/buBrps'>View Raw </a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;/p&gt;</span>
</span><span class='line'><span class="nt">&lt;p&gt;</span>{% codeblock first_graphics_prog.cpp lang:cpp %}
</span><span class='line'>// Author: David Yevick
</span><span class='line'>// Source: A Short Course in Computational Science and Engineering
</span><span class='line'>#include <span class="nt">&lt;iostream&gt;</span>
</span><span class='line'>#include <span class="nt">&lt;dislin.h&gt;&lt;/dislin.h&gt;&lt;/iostream&gt;&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span>using namespace std;<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span>int main(int argc, const char *argv[])
</span><span class='line'>{
</span><span class='line'>    // Some code for defining variables
</span><span class='line'>    // Omitted to avoid copyright problems
</span><span class='line'>    // An example of using DISLIN methods
</span><span class='line'>    qplot(array1,array2,numOfPts);
</span><span class='line'>}
</span><span class='line'>{% endcodeblock %}<span class="nt">&lt;/p&gt;</span>
</span><span class='line'><span class="nt">&lt;p&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Remark: One can view the original file on GitHub by clicking “View
Raw”.</p>

<p>Sometimes, I was <em>unaware</em> of this, especially after writing a
<em>simple</em> post that could surely be correctly parsed by <a href="http://kramdown.gettalong.org/">kramdown</a>.
When I saw something like what’s shown in the above code block in a
category feed page in this blog on the Internet, this error had
already <em>published</em>.</p>

<!-- more -->

<h2 id="a-fix-to-the-above-problem">A “fix” to the above problem</h2>

<p>Re-generate the site <em>again</em>, and wait for luck so that the above
<em>incorrect</em> HTML code will be finally transformed to
<a href="#right_code" class="cliwide">a correct one</a>.</p>

<p>Then one can deploy it to the Internet.</p>

<h2 id="solution">Solution</h2>

<p>As I am <em>not</em> an IT student nor staff, I <em>don’t</em> know the reason.
Therefore, what I can do <em>doesn’t</em> differ much from the above “fix”:
check if the locally generated HTML source code for
<code>/blog/category/foo/atom.xml</code> is OK.</p>

<pre class="cliUB"><code>$ diff -u public/blog/categories/latex/atom.xml _deploy/blog/categories/latex/at
om.xml
--- public/blog/categories/latex/atom.xml       2015-02-14 13:42:46.645744300 +0
800
+++ _deploy/blog/categories/latex/atom.xml      2015-01-18 16:33:33.341309330 +0
800
@@ -4,7 +4,7 @@
   &lt;title&gt;&lt;![CDATA[Category: Latex | Blog 1]]&gt;&lt;/title&gt;
   &lt;link href="http://vincenttam.github.io/blog/categories/latex/atom.xml" rel="
self"/&gt;
   &lt;link href="http://vincenttam.github.io/"/&gt;
-  &lt;updated&gt;2015-02-14T13:41:37+08:00&lt;/updated&gt;
+  &lt;updated&gt;2015-01-18T16:32:04+08:00&lt;/updated&gt;
   &lt;id&gt;http://vincenttam.github.io/&lt;/id&gt;
   &lt;author&gt;
     &lt;name&gt;&lt;![CDATA[Vincent Tam]]&gt;&lt;/name&gt;
</code></pre>

<p>In the above situation, I <em>assume</em> that the previous version of the
<abbr title="Rich Site Summary">RSS</abbr> feed is <em>correct</em>.</p>

<div id="right_code" class="noscr">
  <p><figure class='code'><figcaption><span>Correct version of C/C++ category feed</span><a href='http://goo.gl/YuA1Y9'>View Raw </a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;/p&gt;</span>
</span><span class='line'>  <span class="nt">&lt;p&gt;&lt;div</span> <span class="na">class=</span><span class="s">&#39;bogus-wrapper&#39;</span><span class="nt">&gt;&lt;notextile&gt;&lt;figure</span> <span class="na">class=</span><span class="s">&quot;code&quot;</span><span class="nt">&gt;&lt;figcaption&gt;&lt;span&gt;</span>Sample code <span class="nt">&lt;/span&gt;&lt;/figcaption&gt;</span>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;highlight&quot;</span><span class="nt">&gt;&lt;table&gt;&lt;tr&gt;&lt;td</span> <span class="na">class=</span><span class="s">&quot;gutter&quot;</span><span class="nt">&gt;&lt;pre</span> <span class="na">class=</span><span class="s">&quot;line-numbers&quot;</span><span class="nt">&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;line-number&quot;</span><span class="nt">&gt;</span>1<span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;line-number&quot;</span><span class="nt">&gt;</span>2<span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;line-number&quot;</span><span class="nt">&gt;</span>3<span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;line-number&quot;</span><span class="nt">&gt;</span>4<span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;line-number&quot;</span><span class="nt">&gt;</span>5<span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;line-number&quot;</span><span class="nt">&gt;</span>6<span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;line-number&quot;</span><span class="nt">&gt;</span>7<span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;line-number&quot;</span><span class="nt">&gt;</span>8<span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;line-number&quot;</span><span class="nt">&gt;</span>9<span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;line-number&quot;</span><span class="nt">&gt;</span>10<span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;line-number&quot;</span><span class="nt">&gt;</span>11<span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;line-number&quot;</span><span class="nt">&gt;</span>12<span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;/pre&gt;&lt;/td&gt;&lt;td</span> <span class="na">class=</span><span class="s">&quot;code&quot;</span><span class="nt">&gt;&lt;pre&gt;&lt;code</span> <span class="na">class=</span><span class="s">&quot;cpp&quot;</span><span class="nt">&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;line&quot;</span><span class="nt">&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;c1&quot;</span><span class="nt">&gt;</span>// Author: Helmut Michels<span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;line&quot;</span><span class="nt">&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;c1&quot;</span><span class="nt">&gt;</span>// Source: DISLIN 10.4—A Data Plotting Library<span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;line&quot;</span><span class="nt">&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;cp&quot;</span><span class="nt">&gt;</span>#include <span class="ni">&amp;lt;</span>iostream<span class="ni">&amp;gt;</span><span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;line&quot;</span><span class="nt">&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;cp&quot;</span><span class="nt">&gt;</span>#include <span class="ni">&amp;quot;</span>discpp.h<span class="ni">&amp;quot;&amp;lt;</span>/iostream<span class="ni">&amp;gt;&amp;lt;</span>/p<span class="ni">&amp;gt;</span><span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;line&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;line&quot;</span><span class="nt">&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;o&quot;</span><span class="nt">&gt;</span><span class="ni">&amp;lt;</span><span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;n&quot;</span><span class="nt">&gt;</span>p<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;o&quot;</span><span class="nt">&gt;</span><span class="ni">&amp;gt;</span><span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;n&quot;</span><span class="nt">&gt;</span>main<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;p&quot;</span><span class="nt">&gt;</span>()<span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;line&quot;</span><span class="nt">&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;p&quot;</span><span class="nt">&gt;</span>{<span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;line&quot;</span><span class="nt">&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;n&quot;</span><span class="nt">&gt;</span>Dislin<span class="nt">&lt;/span&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;n&quot;</span><span class="nt">&gt;</span>g<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;p&quot;</span><span class="nt">&gt;</span>;<span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;line&quot;</span><span class="nt">&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;n&quot;</span><span class="nt">&gt;</span>g<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;p&quot;</span><span class="nt">&gt;</span>.<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;n&quot;</span><span class="nt">&gt;</span>disini<span class="nt">&lt;/span&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;p&quot;</span><span class="nt">&gt;</span>();<span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;line&quot;</span><span class="nt">&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;n&quot;</span><span class="nt">&gt;</span>g<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;p&quot;</span><span class="nt">&gt;</span>.<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;n&quot;</span><span class="nt">&gt;</span>messag<span class="nt">&lt;/span&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;p&quot;</span><span class="nt">&gt;</span>(<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;err&quot;</span><span class="nt">&gt;</span>“<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;n&quot;</span><span class="nt">&gt;</span>This<span class="nt">&lt;/span&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;n&quot;</span><span class="nt">&gt;</span>is<span class="nt">&lt;/span&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;n&quot;</span><span class="nt">&gt;</span>a<span class="nt">&lt;/span&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;n&quot;</span><span class="nt">&gt;</span>test<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;err&quot;</span><span class="nt">&gt;</span>”<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;p&quot;</span><span class="nt">&gt;</span>,<span class="nt">&lt;/span&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;mi&quot;</span><span class="nt">&gt;</span>100<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;p&quot;</span><span class="nt">&gt;</span>,<span class="nt">&lt;/span&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;mi&quot;</span><span class="nt">&gt;</span>100<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;p&quot;</span><span class="nt">&gt;</span>);<span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;line&quot;</span><span class="nt">&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;n&quot;</span><span class="nt">&gt;</span>g<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;p&quot;</span><span class="nt">&gt;</span>.<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;n&quot;</span><span class="nt">&gt;</span>disfin<span class="nt">&lt;/span&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;p&quot;</span><span class="nt">&gt;</span>();<span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;line&quot;</span><span class="nt">&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;p&quot;</span><span class="nt">&gt;</span>}<span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;&lt;/p&gt;</span>
</span><span class='line'>  <span class="nt">&lt;p&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>
</div>
]]></content>
    
  </entry>
  
  <entry>
    
      <title type="html"><![CDATA[Use Tmux for Previewing Posts]]></title>
      <link href="https://vincenttam.github.io/blog/2015/02/14/use-tmux-for-previewing-posts/"/>
    
    <updated>2015-02-14T14:04:38+08:00</updated>
    <id>https://vincenttam.github.io/blog/2015/02/14/use-tmux-for-previewing-posts</id>
    
      <content type="html"><![CDATA[<h2 id="problem">Problem</h2>

<p>After I finished an Octopress post, one may check if there’s any error
by previewing the post.  In GUI, it’s easy: just open a new window.
<strong>How about in Linux text mode?</strong></p>

<h2 id="a-so-called-method">A so-called method</h2>

<p>Add an ampersand ‘&amp;’ behind the command for previewing the blog.
However, while viewing the site in a browser, the contents would be
<em>covered</em> by some lines.</p>

<pre class="cliUB"><code>127.0.0.1 - - [14/Feb/2015:13:46:08 +0800] "GET / HTTP/1.1" 200 39685 0.0024
127.0.0.1 - - [14/Feb/2015:13:46:14 +0800] "GET /blog/2015/02/14/tried-range-bas
ed-for-loop/ HTTP/1.1" 200 21821 0.0028
127.0.0.1 - - [14/Feb/2015:13:46:59 +0800] "GET /atom.xml HTTP/1.1" 200 131801 0
.0071
</code></pre>

<p>This can be an inconvenience.  It <em>isn’t</em> hard to log on <em>another TTY</em>
and open the browser there, but one has to type the password
<em>twice</em>—this is <em>still</em> inconvenient.</p>

<h2 id="solution">Solution</h2>

<p>I now use <a href="http://byobu.co" title="a free terminal multiplexer">Byobu</a>, which depends on <a href="http://tmux.sourceforge.net" title="a terminal multiplexer">Tmux</a>, to preview the generated
blog.<sup id="fnref:fig"><a href="#fn:fig" class="footnote">1</a></sup></p>

<hr />

<div class="footnotes">
  <ol>
    <li id="fn:fig">
      <p>The <a href="/images/posts/Tmux/tmux.png" title="Tmux on Ubuntu" class="fancybox">screenshot</a> of Tmux. <a href="#fnref:fig" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>
]]></content>
    
  </entry>
  
  <entry>
    
      <title type="html"><![CDATA[Octopress, PageSpeed, jQuery and fancyBox]]></title>
      <link href="https://vincenttam.github.io/blog/2014/12/29/octopress-pagespeed-jquery-and-fancybox/"/>
    
    <updated>2014-12-29T16:17:52+08:00</updated>
    <id>https://vincenttam.github.io/blog/2014/12/29/octopress-pagespeed-jquery-and-fancybox</id>
    
      <content type="html"><![CDATA[<h2 id="goal">Goal</h2>

<p>To improve the <a href="https://developers.google.com/speed/pagespeed/">Google PageSpeed</a> scores of this site.</p>

<h2 id="background">Background</h2>

<p>I use <a href="http://www.mathjax.org">MathJax</a> and <a href="http://fancyapps.com/fancybox/">fancyBox</a> for displaying math equations and
images respectively.</p>

<h2 id="problem">Problem</h2>

<p>As shown in the following two pictures, the <a href="https://developers.google.com/speed/pagespeed/">PageSpeed</a> scores of the
homepage of this blog for “Mobile” and “Desktop” were very <em>low</em>.</p>

<picture class="fancybox center" title="PageSpeed score for &quot;Mobile&quot;">
  <source srcset="/images/posts/PageSpeed/m_score1.png" media="(min-width: 980px)" />
  <img alt="pagespeed score mobile" src="https://vincenttam.github.io/images/posts/PageSpeed/m_score1_s.png" />
</picture>

<picture class="fancybox center" title="PageSpeed score for &quot;Desktop&quot;">
  <source srcset="/images/posts/PageSpeed/d_score1.png" media="(min-width: 650px)" />
  <img alt="pagespeed score desktop" src="https://vincenttam.github.io/images/posts/PageSpeed/d_score1_s.png" />
</picture>

<h2 id="solution">Solution</h2>

<p>I followed the advice of Google Developers, and deferred loading of
JavaScripts.</p>

<h3 id="results">Results</h3>

<p>After a week’s work, the PageSpeed has risen.</p>

<p><img class="fancybox center" src="/images/posts/PageSpeed/m_score3.png" title="‘PageSpeed score for Mobile’ ‘mobile pagespeed score’" ></p>

<picture class="fancybox center" title="PageSpeed score for &quot;Desktop&quot;">
  <source srcset="/images/posts/PageSpeed/d_score3.png" media="(min-width: 360px)" />
  <img alt="pagespeed score desktop" src="https://vincenttam.github.io/images/posts/PageSpeed/d_score3_s.png" />
</picture>

<!-- more -->

<h3 id="html-headers">HTML Headers</h3>

<p>I removed render-blocking JavaScripts and stylesheets in the HTML
Headers.</p>

<ol>
  <li>Deleted all <code>&lt;script&gt;</code> and <code>&lt;link rel="stylesheet" ... /&gt;</code> tags in
<code>source/_includes/custom/head.html</code>, <em>except</em> <code>&lt;link
src="https://vincenttam.github.io/stylesheets/print.css" ... /&gt;</code>.</li>
  <li>Deleted the lines which loads <a href="http://jquery.com">jQuery</a>, <a href="http://modernizr.com">Modernizr</a>,
<code>/javascripts/octopress.js</code> and <code>/stylesheets/screen.css</code>.</li>
</ol>

<p><figure class='code'><figcaption><span>Lines to be removed from the default HTML head </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;/p&gt;</span>
</span><span class='line'><span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">&quot;/stylesheets/screen.css&quot;</span> <span class="na">media=</span><span class="s">&quot;screen,</span>
</span><span class='line'><span class="s">projection&quot;</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;/javascripts/modernizr-2.0.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;/script&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;script&gt;</span><span class="o">!</span><span class="nb">window</span><span class="p">.</span><span class="nx">jQuery</span> <span class="o">&amp;&amp;</span> <span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">unescape</span><span class="p">(</span><span class="s1">&#39;%3Cscript</span>
</span><span class='line'><span class="s1">src=&quot;https://vincenttam.github.io/javascripts/libs/jquery.min.js&quot;%3E%3C/script%3E&#39;</span><span class="p">))</span><span class="nt">&lt;/script&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;/javascripts/octopress.js&quot;</span> <span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;/script&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<h3 id="combine-and-compress-fancybox-javascripts">Combine and compress fancyBox JavaScripts</h3>

<p>I used the online JavaScript compressor at <a href="http://jscompress.com">http://jscompress.com</a>.
First, I clicked the “Upload Javascript Files” tabbed pane.  After
that, uploaded the three JavaScripts for fancyBox helpers:<sup id="fnref:nowheel"><a href="#fn:nowheel" class="footnote">1</a></sup></p>

<ol>
  <li><code>/fancybox/source/helpers/jquery.fancybox-buttons.js?v=1.0.5</code></li>
  <li><code>/fancybox/source/helpers/jquery.fancybox-media.js?v=1.0.6</code></li>
  <li><code>/fancybox/source/helpers/jquery.fancybox-thumbs.js?v=1.0.7</code></li>
</ol>

<p>I then downloaded the compressed output.</p>

<h3 id="after-the-html-footer">After the HTML footer</h3>

<p>To load the scripts, especially Google hosted jQuery (or a local copy
of it in case that the remote library <em>can’t</em> load) and <a href="http://fancyapps.com/fancybox/">fancyBox</a>,
and the stylesheets after the contents in the <code>&lt;body&gt;</code> tag has been
loaded, I added the following lines to
<code>source/_includes/custom/after_footer.html</code>.</p>

<p><figure class='code'><figcaption><span>Defer loading of JavaScripts and stylesheets </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="c1">// For loading JavaScripts</span>
</span><span class='line'><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">function</span> <span class="nx">getScript</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="nx">success</span><span class="p">){</span>
</span><span class='line'>	<span class="kd">var</span> <span class="nx">script</span><span class="o">=</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">);</span>
</span><span class='line'>	<span class="nx">script</span><span class="p">.</span><span class="nx">src</span><span class="o">=</span><span class="nx">url</span><span class="p">;</span>
</span><span class='line'>	<span class="kd">var</span> <span class="nx">head</span><span class="o">=</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;head&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
</span><span class='line'>	<span class="nx">done</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span>
</span><span class='line'>	<span class="nx">script</span><span class="p">.</span><span class="nx">onload</span><span class="o">=</span><span class="nx">script</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>	<span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">done</span> <span class="o">&amp;</span><span class="nx">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="nx">amp</span><span class="p">;</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">==</span> <span class="s1">&#39;loaded&#39;</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">==</span> <span class="s1">&#39;complete&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>	    <span class="nx">done</span><span class="o">=</span><span class="kc">true</span><span class="p">;</span>
</span><span class='line'>	    <span class="nx">success</span><span class="p">();</span>
</span><span class='line'>	    <span class="nx">script</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="nx">script</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'>	    <span class="nx">head</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">script</span><span class="p">);</span>
</span><span class='line'>	<span class="p">}</span>
</span><span class='line'>	<span class="p">};</span>
</span><span class='line'>	<span class="nx">head</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">script</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span><span class="nt">&lt;/script&gt;&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;pre&gt;&lt;code&gt;</span>// Any scripts independent of jQuery
</span><span class='line'>getScript(&quot;/javascripts/modernizr-2.0.js&quot;,function() {});
</span><span class='line'>getScript(&quot;https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML&quot;+
</span><span class='line'>&quot;,https://vincenttam.github.io/javascripts/MathJaxLocal.js&quot;,function() {});
</span><span class='line'>
</span><span class='line'>// Google hosted jquery and fancyBox JavaScripts
</span><span class='line'>getScript(&quot;//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js&quot;,function(){
</span><span class='line'>  getScript(&quot;/javascripts/octopress.js&quot;,function() {});
</span><span class='line'>  getScript(&quot;/fancybox/source/jquery.fancybox.pack.js?v=2.1.5&quot;, function() {
</span><span class='line'>getScript(&quot;/fancybox/source/helpers/all.js&quot;, function() {
</span><span class='line'>  getScript(&quot;/javascripts/FancyBoxLocal.js&quot;, function() {});
</span><span class='line'>  });
</span><span class='line'>});
</span><span class='line'>  });
</span><span class='line'>
</span><span class='line'>// jquery fallback local copy and fancyBox JavaScripts
</span><span class='line'>window.onload = function() {
</span><span class='line'>  if (typeof jQuery == &quot;undefined&quot;) {
</span><span class='line'>var jqri = document.createElement(&quot;script&quot;);
</span><span class='line'>jqri.src = &quot;/javascripts/libs/jquery.min.js&quot;;
</span><span class='line'>jqri.type = &quot;text/javascript&quot;;
</span><span class='line'>document.body.appendChild(jqri);
</span><span class='line'>jqri. onload = function () {
</span><span class='line'>  var fbjs = document.createElement(&quot;script&quot;);
</span><span class='line'>  fbjs.src = &quot;/fancybox/source/jquery.fancybox.pack.js?v=2.1.5&quot;;
</span><span class='line'>  fbjs.type = &quot;text/javascript&quot;;
</span><span class='line'>  document.body.appendChild(fbjs);
</span><span class='line'>  var fball = document.createElement(&quot;script&quot;);
</span><span class='line'>  fball.src = &quot;./octopress/source/fancybox/source/helpers/all.js&quot;;
</span><span class='line'>  fball.type = &quot;text/javascript&quot;;
</span><span class='line'>  document.body.appendChild(fball);
</span><span class='line'>  fbjs.onload = function () {
</span><span class='line'>    fball.onload = function () {
</span><span class='line'>      var fblocjs = document.createElement(&quot;script&quot;);
</span><span class='line'>      fblocjs.src = &quot;/javascripts/FancyBoxLocal.js&quot;;
</span><span class='line'>      fblocjs.type = &quot;text/javascript&quot;;
</span><span class='line'>      document.body.appendChild(fblocjs);
</span><span class='line'>    }
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>  }
</span><span class='line'>} })();
</span><span class='line'><span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span>// For loading CSS files
</span><span class='line'>var cb = function() {
</span><span class='line'>  var h = document.getElementsByTagName(‘head’)[0];<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span>// Fonts from Google’s Web font directory
</span><span class='line'>  var font1 = document.createElement(“link”);
</span><span class='line'>  font1.href = “//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic”;
</span><span class='line'>  font1.rel = “stylesheet”;
</span><span class='line'>  font1.type = “text/css”;
</span><span class='line'>  h.parentNode.insertBefore(font1, h);<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span>var font2 = document.createElement(“link”);
</span><span class='line'>  font2.href = “//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic”;
</span><span class='line'>  font2.rel = “stylesheet”;
</span><span class='line'>  font2.type = “text/css”;
</span><span class='line'>  h.parentNode.insertBefore(font2, h);<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span>// any other external CSS<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span>// CSS files for FancyBox
</span><span class='line'>  var fbcss = document.createElement(“link”);
</span><span class='line'>  fbcss.href = “/fancybox/source/jquery.fancybox.css?v=2.1.5”;
</span><span class='line'>  fbcss.rel = “stylesheet”;
</span><span class='line'>  fbcss.type = “text/css”;
</span><span class='line'>  fbcss.media = “screen, projection”;
</span><span class='line'>  document.body.appendChild(fbcss);
</span><span class='line'>  var fbbtncss = document.createElement(“link”);
</span><span class='line'>  fbbtncss.href = “/fancybox/source/helpers/jquery.fancybox-buttons.css?v=1.0.5”;
</span><span class='line'>  fbbtncss.rel = “stylesheet”;
</span><span class='line'>  fbbtncss.type = “text/css”;
</span><span class='line'>  fbbtncss.media = “screen, projection”;
</span><span class='line'>  document.body.appendChild(fbbtncss);
</span><span class='line'>  var fbthmcss = document.createElement(“link”);
</span><span class='line'>  fbthmcss.href = “/fancybox/source/helpers/jquery.fancybox-thumbs.css?v=1.0.7”;
</span><span class='line'>  fbthmcss.rel = “stylesheet”;
</span><span class='line'>  fbthmcss.type = “text/css”;
</span><span class='line'>  fbthmcss.media = “screen, projection”;
</span><span class='line'>  document.body.appendChild(fbthmcss);
</span><span class='line'>};<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span>var raf = requestAnimationFrame || mozRequestAnimationFrame ||
</span><span class='line'>    webkitRequestAnimationFrame || msRequestAnimationFrame;
</span><span class='line'>if (raf) raf(cb);
</span><span class='line'>else window.addEventListener(‘load’, cb);
</span><span class='line'><span class="ni">&amp;lt;</span>/script<span class="ni">&amp;gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<h3 id="improve-user-experience">Improve user experience</h3>

<p>Google PageSpeed Insights said that my homepage was too <em>wide</em> for
mobile devices whose width were 320 px.  Therefore, I’ve tried
preparing different pictures for windows of different width by
<code>&lt;picutre&gt;</code> tags with <code>&lt;source srcset=...&gt;</code> inside.  Although this
pure HTML 5 approach is now supported in Google Chrome <em>only</em>, I find
this method simple and beautiful.<sup id="fnref:pic_elt"><a href="#fn:pic_elt" class="footnote">2</a></sup>  Due to its elegance, I
believe that this feature will soon be implemented in all major
browsers, such as Mozilla Firefox.</p>

<p><figure class='code'><figcaption><span>Part of pages/posts contents </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;/p&gt;</span>
</span><span class='line'><span class="nt">&lt;picture</span> <span class="na">class=</span><span class="s">&quot;fancybox center&quot;</span> <span class="na">title=</span><span class="s">&quot;Custom search failed&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;source</span> <span class="na">srcset=</span><span class="s">&quot;/images/big.png&quot;</span> <span class="na">media=</span><span class="s">&quot;(min-width: 880px)&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>  <span class="c">&lt;!-- a fallback for browsers that don&#39;t support the source tag --&gt;</span>
</span><span class='line'>  <span class="nt">&lt;img</span> <span class="na">alt=</span><span class="s">&quot;alt text&quot;</span> <span class="na">src=</span><span class="s">&quot;https://vincenttam.github.io/images/small.png&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;/picture&gt;</span>
</span><span class='line'><span class="nt">&lt;p&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>The simplest way to avoid getting the message “Optimize images” in a
PageSpeed test is to optimize the images.  <a href="http://optipng.sourceforge.net/">OptiPNG</a> can be used for
this.  Before compressing the images, I issued the following command
to create a diminished image of width 300 px of the original image.</p>

<pre class="cliUB"><code>$ optipng big.png
$ convert big.png -resize 300 small.png
$ optipng small.png
</code></pre>

<p>How to enable fancyBox for <code>&lt;picture&gt;</code> elements?  I did a bit of
“guided coding” — I copied Erv Walter’s function and changed a few
lines.<sup id="fnref:erv"><a href="#fn:erv" class="footnote">3</a></sup></p>

<p><figure class='code'><figcaption><span>Part of my “/javascripts/FancyBoxLocal.js” </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">$</span><span class="p">(</span><span class="err">‘</span><span class="p">.</span><span class="nx">entry</span><span class="o">-</span><span class="nx">content</span><span class="err">’</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">){</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">_i</span> <span class="o">=</span> <span class="nx">i</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="err">‘</span><span class="nx">img</span><span class="p">.</span><span class="nx">fancybox</span><span class="err">’</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>      <span class="c1">// Erv Walter’s function …</span>
</span><span class='line'>    <span class="p">}</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;picture.fancybox&#39;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">picture</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">picture</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">picture</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;fancybox&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">picture</span><span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">).</span><span class="nx">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;srcset&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">picture</span><span class="p">.</span><span class="nx">wrap</span><span class="p">(</span><span class="s1">&#39;&amp;lt;a href=&quot;&#39;</span><span class="o">+</span><span class="nx">url</span><span class="o">+</span><span class="s1">&#39;&quot; class=&quot;fancybox&quot; rel=&quot;galleryp&#39;</span><span class="o">+</span><span class="nx">_i</span><span class="o">+</span><span class="s1">&#39;&quot; /&amp;gt;&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">title</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'><span class="nx">picture</span><span class="p">.</span><span class="nx">parent</span><span class="p">().</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="nx">title</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>   <span class="p">});</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="c1">// settings found on fancyBox’s homepage …</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>View the file at commit <a href="https://github.com/VincentTam/vincenttam.github.io/commit/29d86dd">29d86dd</a> for a working example.</p>

<p>Lastly, to ensure that the contents <em>wouldn’t</em> fall outside the
viewport on the screen of mobile devices, I embedded an inline CSS.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;/p&gt;</span>
</span><span class='line'><span class="nt">&lt;style&gt;article</span> <span class="nt">img</span> <span class="p">{</span><span class="k">max-width</span><span class="o">:</span><span class="m">100%</span><span class="p">;}</span><span class="nt">&lt;/style&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Though this <em>wasn’t</em> good, it enabled me to get rid of the above
message about image optimization in a PageSpeed test.</p>

<h2 id="lessons-learnt">Lessons learnt</h2>

<h3 id="my-first-way-to-load-javascripts-from-a-script">My first way to load JavaScripts from a script</h3>

<p>Due to my homework and exams in early December and my <em>limited
knowledge</em> on JavaScripts, I <em>didn’t</em> have time to understand the
section “Defer loading of JavaScript” in
<a href="https://developers.google.com/speed/docs/insights/BlockingJS">a suggestion page on Google Developers</a>.  On Dec 20,
2014, I found an article on feedthebot useful.<sup id="fnref:feedthebot"><a href="#fn:feedthebot" class="footnote">4</a></sup>  I copied
the codeblock and changed <code>defer.js</code> to other files.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">downloadJSAtOnload</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">element</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">element</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s2">&quot;defer.js&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">)</span>
</span><span class='line'>  <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;load&quot;</span><span class="p">,</span> <span class="nx">downloadJSAtOnload</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'><span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">)</span>
</span><span class='line'>  <span class="nb">window</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">(</span><span class="s2">&quot;onload&quot;</span><span class="p">,</span> <span class="nx">downloadJSAtOnload</span><span class="p">);</span>
</span><span class='line'><span class="k">else</span> <span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="nx">downloadJSAtOnload</span><span class="p">;</span>
</span><span class='line'><span class="nt">&lt;/script&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>In M$ I.E., one has to use <code>window.attachEvent</code> instead of
<code>window.addEventListener</code>.  The last line acts as a fallback for old
browsers.</p>

<p>This works for MathJax.  However, for fancyBox, which depends on
jQuery, strange things happened, and I got trapped for two days.  I
had wrote a function which worked in Google Chrome, but when I opened
Mozilla Firefox to test the results, <em>no</em> box popped out and I was
taken to a page containing merely the picture.  I was puzzled and made
a Git commit.<sup id="fnref:e7e6743"><a href="#fn:e7e6743" class="footnote">5</a></sup></p>

<h3 id="my-second-way-to-load-javascripts-from-a-script">My second way to load JavaScripts from a script</h3>

<p>I googled “defer jquery fancybox”, and found a question on Stack
Overflow.<sup id="fnref:so16647050"><a href="#fn:so16647050" class="footnote">6</a></sup>  I made use of Jamed Donnelly’s functions, and
had successfully made a popped up image, which meant that the loading
of JavaScripts for fancyBox had been deferred.</p>

<p><figure class='code'><figcaption><span>Just before the closing body tag </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;script&gt;</span>
</span><span class='line'><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">function</span> <span class="nx">getScript</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="nx">success</span><span class="p">){</span>
</span><span class='line'>	<span class="kd">var</span> <span class="nx">script</span><span class="o">=</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">);</span>
</span><span class='line'>	<span class="nx">script</span><span class="p">.</span><span class="nx">src</span><span class="o">=</span><span class="nx">url</span><span class="p">;</span>
</span><span class='line'>	<span class="kd">var</span> <span class="nx">head</span><span class="o">=</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;head&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
</span><span class='line'>	<span class="nx">done</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span>
</span><span class='line'>	<span class="nx">script</span><span class="p">.</span><span class="nx">onload</span><span class="o">=</span><span class="nx">script</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>	<span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">done</span> <span class="o">&amp;</span><span class="nx">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="nx">amp</span><span class="p">;</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">==</span> <span class="s1">&#39;loaded&#39;</span>
</span><span class='line'>	  <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">==</span> <span class="s1">&#39;complete&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>	    <span class="nx">done</span><span class="o">=</span><span class="kc">true</span><span class="p">;</span>
</span><span class='line'>	    <span class="nx">success</span><span class="p">();</span>
</span><span class='line'>	    <span class="nx">script</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="nx">script</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'>	    <span class="nx">head</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">script</span><span class="p">);</span>
</span><span class='line'>	<span class="p">}</span>
</span><span class='line'>	<span class="p">};</span>
</span><span class='line'>	<span class="nx">head</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">script</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span><span class="nt">&lt;/script&gt;&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span>getScript(“jquery-1.8.3.min.js”,function(){
</span><span class='line'>    getScript(“jquery.fancybox-1.3.4/fancybox/jquery.fancybox-1.3.4.pack.js”, function() {});
</span><span class='line'>    getScript(“myCustomScript.js”, function() {});
</span><span class='line'>});<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span>})();
</span><span class='line'><span class="ni">&amp;lt;</span>/script<span class="ni">&amp;gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><figcaption><span>A separate file “myCustomScript.js” </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="nx">$</span><span class="p">(</span><span class="err">“</span><span class="p">.</span><span class="nx">example3</span><span class="err">”</span><span class="p">).</span><span class="nx">fancybox</span><span class="p">({</span>
</span><span class='line'>	<span class="err">‘</span><span class="nx">transitionIn</span><span class="err">’</span>  <span class="o">:</span> <span class="err">‘</span><span class="nx">none</span><span class="err">’</span><span class="p">,</span>
</span><span class='line'>	<span class="err">‘</span><span class="nx">transitionOut</span><span class="err">’</span> <span class="o">:</span> <span class="err">‘</span><span class="nx">none</span><span class="err">’</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Nonetheless, the image title and the close icon were <em>missing</em>.</p>

<h3 id="view-loaded-resources-and-the-timeline">View loaded resources and the timeline</h3>

<p>I had tried using “Network” in the developer toolbar in both Google
Chromium and Mozilla Firefox to view the time taken for loading the
scripts and CSS files.  I contrasted the timelines of working sites
and my failed trials, and then made changes to the above script before
the <code>&lt;/body&gt;</code> tag.</p>

<h3 id="test-javascript-functions-using-the-web-console">Test Javascript functions using the web console</h3>

<p>While testing the script in
<code>source/_includes/custom/after_footer.html</code>, the scripts often
<em>failed</em> to work.  The error console in web browsers spotted out the
missing brackets and other syntax errors.  Moreover, it told me
whether jQuery had been loaded if I typed <code>typeof jQuery</code>.</p>

<h3 id="access-the-children-of-an-html-element-with-jquery">Access the children of an HTML element with jQuery</h3>

<p>While writing the anonymous function in
<code>/javascripts/FancyBoxLocal.js</code>, I tried to extract the URL of the
<code>&lt;source&gt;</code> element inside a <code>&lt;picture&gt;</code> element.  In the web console,
if <code>typeof jQuery</code> returns <code>"function"</code>,
<code>$('picture').children('source').length</code> returns a non-negative
integer.  If the integer returned is positive,
<code>$('picture').children('source')[0].srcset</code> returns
<code>"/images/foo.png"</code> and <code>"undefined"</code> in Google Chromium and Mozilla
Firefox respectively.</p>

<p>I played with the example on W3Schools about the <code>children()</code> method
in jQuery.<sup id="fnref:w3sch"><a href="#fn:w3sch" class="footnote">7</a></sup>  After re-writing the code and seeing the result
repeatedly, I’ve learnt to use the <code>eq(n)</code> and <code>attr(source)</code> methods
to access the <code>n</code>-th element and the <code>source</code> attribute.</p>

<h3 id="load-css-files-from-a-script">Load CSS files from a script</h3>

<p>Google Developers has already provided a script for doing
so.<sup id="fnref:goo_dev_css"><a href="#fn:goo_dev_css" class="footnote">8</a></sup>  At first, I <em>didn’t</em> understand it and I tried
injecting a <code>&lt;link&gt;</code> element inside the <code>downloadJSAtOnload()</code> method.
Unluckily, this method <em>failed</em>.  <em>Without</em> <code>/stylesheets/screen.css</code>,
the Solarized theme <em>disappeared</em>, and was “replaced by a
black-and-white theme”.  After that, I re-read Google’s page on CSS
delivery optimization, and extracted the script which grabbed external
stylesheets.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;script&gt;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">cb</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">l</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;link&#39;</span><span class="p">);</span> <span class="nx">l</span><span class="p">.</span><span class="nx">rel</span> <span class="o">=</span> <span class="s1">&#39;stylesheet&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">l</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="s1">&#39;small.css&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">h</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;head&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span> <span class="nx">h</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">l</span><span class="p">,</span> <span class="nx">h</span><span class="p">);</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">raf</span> <span class="o">=</span> <span class="nx">requestAnimationFrame</span> <span class="o">||</span> <span class="nx">mozRequestAnimationFrame</span> <span class="o">||</span>
</span><span class='line'>      <span class="nx">webkitRequestAnimationFrame</span> <span class="o">||</span> <span class="nx">msRequestAnimationFrame</span><span class="p">;</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">raf</span><span class="p">)</span> <span class="nx">raf</span><span class="p">(</span><span class="nx">cb</span><span class="p">);</span>
</span><span class='line'>  <span class="k">else</span> <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
</span><span class='line'><span class="nt">&lt;/script&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>From “Network” in the web developer toolbar, in an up-to-date version
of modern browsers, this anonymous function which loads external CSS
files should be executed <em>before</em> <code>script.onload</code> and <code>window.onload</code>.</p>

<p>In addition, unlike Javascripts, I <em>don’t</em> use something like
<code>stylesheet.onload</code>.  Simply put the relative path or URL of the
external CSS files inside the anonymous function will do.</p>

<p>After I grabbed the stylesheets before the external Javascripts
loaded, the missing components of the pop up window were <em>still</em>
missing.  It took me half an hour to figure out that <code>l.rel =
'stylesheet'</code> <em>couldn’t</em> be omitted.  I then pushed commit <a href="https://github.com/VincentTam/vincenttam.github.io/commit/1d40cea">1d40cea</a>
to GitHub and claimed that I’d found a way for both Google Chrome and
Mozilla Firefox.</p>

<p>The next day, I tested it with M$ I.E., and older versions of Google
Chrome and Mozilla Firefox.  In older versions, my configurations had
<em>failed</em>, but they worked fine in the recent ones.  For example, the
method of loading external Javascripts in a non-render-blocking manner
as suggested by Google Developers <em>didn’t</em> work in Mozilla Firefox 14,
which <em>didn’t</em> support <code>requestAnimationFrame</code>.  Though
<code>mozRequestAnimationFrame</code> was supported, if they’re put together, the
whole thing would collapse.  Since I’m <em>not</em> a web
designer/programmer, I <em>won’t</em> consider fixing this problem since</p>

<ul>
  <li>the old versions of browsers will be eventually upgraded, and more
  importantly,</li>
  <li>I’ve other (non-technical) problems to solve.</li>
</ul>

<h3 id="onload-and-createelement">Onload and createElement()</h3>

<p>I’ve read a question on Stack Overflow, and understood that even
though a <code>&lt;script&gt;</code> element with the <code>src='/javascripts/foo.js'</code>
attribute had been created by the <code>createElement()</code> function, the
functions defined in the external script <code>/javascripts/foo.js</code> could
be <em>unusable</em> if one <em>doesn’t</em> make proper use of <code>script.onload</code>.</p>

<h3 id="a-fallback-for-google-hosted-jquery">A fallback for Google hosted jQuery</h3>

<p>In my opinion, this is the <em>most</em> difficult part, which has taken me a
<em>whole</em> day.</p>

<p>I observed that loading <em>both</em> the local and remote copy of jQuery was
<em>incorrect</em>.  Since jQuery is relatively <em>large</em>, leaving this problem
unsolved is like leaving a black dot on a whiteboard.</p>

<p>One <em>can’t</em> simply remove the local copy of jQuery since Google is
<em>blocked</em> in some regions.<sup id="fnref:news"><a href="#fn:news" class="footnote">9</a></sup>  There’re some political reasons
behind.  Unlike Zigang Xiao’s blog, I’m <em>not</em> going to write any
articles on politics.<sup id="fnref:po"><a href="#fn:po" class="footnote">10</a></sup>  I’ll just seek a <em>technical</em> solution to
this <em>political</em> problem.</p>

<p>This problem is <em>extremely difficult</em> for me since I’m <em>not</em> a student
of IT, and there’s <em>no</em> direct solution from the Internet.  Inside and
outside the function triggered by an <code>onload</code> event, code <em>aren’t</em>
executed sequencially, but <em>in parallel</em>.  Therefore, if I put <code>if
(typeof jQuery == 'undefined')</code> after <code>getScript(...)</code>, then even
though the Google hosted jQuery library can be downloaded, the if
statement returns <em>true</em>.  Google Chromium and Mozilla Firefox showed
<em>different</em> results for the <em>same</em> JavaScript.  This increased the
difficulty of the task.</p>

<p>While coming up with a solution, I looked at
<code>source/_includes/head.html</code>, and found the following line.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;script&gt;</span><span class="o">!</span><span class="nb">window</span><span class="p">.</span><span class="nx">jQuery</span> <span class="o">&amp;</span><span class="nx">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="nx">amp</span><span class="p">;</span> <span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">unescape</span><span class="p">(</span><span class="s1">&#39;%3Cscript</span>
</span><span class='line'><span class="s1">src=&quot;./javascripts/libs/jquery.min.js&quot;%3E%3C/script%3E&#39;</span><span class="p">))</span><span class="nt">&lt;/script&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><em>Not</em> being familiar with JavaScript syntax, I searched for the
meaning of the <code>unescape()</code> function and that of the ‘.’ in front of
<code>/javascripts/...</code>.  After viewing a question on Stack Overflow, I
decided to create the <a href="https://github.com/imathis/octopress/pull/1699/" title="Fix the way of loading the local copy of jQuery">pull request #1699</a> of Octopress.
Luckily, it was accepted and merged into the <code>master</code> branch of
Octopress.</p>

<p>After doing some off-topic stuff, I curiously reproduced the error
described in the first subsection of this section, and figured out a
way to fix this error.  During the process, I’ve learnt the dependence
of difference scripts  Therefore, the correct sequence should be</p>

<ol>
  <li>Load <code>jquery.min.js</code>.</li>
  <li>Load <code>octopress.js</code> and <code>/fancybox/source/jquery.fancybox.js</code>.</li>
  <li>Load <code>/fancybox/source/helpers/jquery.fancybox-*.js</code>.</li>
  <li>Load <code>FancyBoxLocal.js</code>.</li>
</ol>

<p>For example, <code>appendChild(octopress)</code> should be <em>inside</em>
<code>jquery.onload = function() {...}</code>.</p>

<p>Finally, using “Network” in the web developer toolbar in Google
Chromium, I observed that <em>before</em> the <code>window.onload</code> event, the
<code>getScript(...)</code> method had already got the scripts.  I combined the
two ways, and solved the problem.</p>

<hr />

<div class="footnotes">
  <ol>
    <li id="fn:nowheel">

      <p>I <em>didn’t</em> use the mousewheel plugin.  If one uses a mouse click
to get the popped up window, then he/she can also view the
next/previous picture with a click. <a href="#fnref:nowheel" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:pic_elt">

      <p>See, for example,
<a href="http://www.html5rocks.com/en/tutorials/responsive/picture-element/"><em>Built-in Browser Support for Responsive Images</em></a> by Pearl
Chen on HTML 5 Rocks, for an introduction to the <code>&lt;picture&gt;</code>
element. <a href="#fnref:pic_elt" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:erv">

      <p>See <a href="http://www.ewal.net/2012/09/08/octopress-customizations/"><em>Octopress Customizations</em></a> by Erv Walter on ewal.net. <a href="#fnref:erv" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:feedthebot">

      <p><a href="http://www.feedthebot.com/pagespeed/defer-loading-javascript.html"><em>Defer Loading Javascript</em></a> by Patrick Sexton on
feedthebot. <a href="#fnref:feedthebot" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:e7e6743">
      <p>See commit <a href="https://github.com/VincentTam/vincenttam.github.io/commit/e7e6743">e7e6743</a> for details. <a href="#fnref:e7e6743" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:so16647050">

      <p>See <a href="http://stackoverflow.com/q/16647050"><em>How to defer javascript</em></a> on Stack Overflow for
the function. <a href="#fnref:so16647050" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:w3sch">

      <p>The online example is available at
<a href="http://www.w3schools.com/jquery/tryit.asp?filename=tryjquery_children2">http://www.w3schools.com/jquery/tryit.asp?filename=tryjquery_children2</a> <a href="#fnref:w3sch" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:goo_dev_css">

      <p>See <a href="https://developers.google.com/speed/docs/insights/OptimizeCSSDelivery"><em>Optimize CSS delivery</em></a> on Google Developers
for details. <a href="#fnref:goo_dev_css" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:news">

      <p><a href="http://techcrunch.com/2010/04/19/google-censorship/"><em>Google Is Blocked In 25 Of The 100 Countries They Offer Products In</em></a>
by MG Siegler on TechCrunch. <a href="#fnref:news" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:po">
      <p><a href="http://blog.ivansiu.com/blog/2014/10/01/jing-ying-zhu-yi-yu-tou-piao-kao-shi/"><em>精英主義與投票考試</em></a> by Zigang Xiao. <a href="#fnref:po" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>
]]></content>
    
  </entry>
  
</feed>
