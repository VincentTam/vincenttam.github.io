<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: M$ Win* | Blog 1]]></title>
  <link href="https://vincenttam.github.io/blog/categories/m$-win-star/atom.xml" rel="self"/>
  <link href="https://vincenttam.github.io/"/>
  <updated>2016-02-22T14:15:51+08:00</updated>
  <id>https://vincenttam.github.io/</id>
  <author>
    <name><![CDATA[Vincent Tam]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    
      <title type="html"><![CDATA[Rake Deploy Fatal Error]]></title>
      <link href="https://vincenttam.github.io/blog/2016/02/22/rake-deploy-fatal-error/"/>
    
    <updated>2016-02-22T12:16:16+08:00</updated>
    <id>https://vincenttam.github.io/blog/2016/02/22/rake-deploy-fatal-error</id>
    
      <content type="html"><![CDATA[<h2 id="background">Background</h2>

<p>I had finished writing <a href="/blog/2016/02/22/git-for-windows-curl-gist-dot-vim-with-vundle-1/">my previous post</a>.  In <code>rake preview</code>, I
got the desired output.  Then, the next step is to commit the changes
and to deploy the generated contents to GitHub Pages.</p>

<h2 id="problem">Problem</h2>

<p>A large block of red text appeared after I ran <code>rake deploy</code>.  The
commit on the <code>master</code> branch was <em>unsuccessful</em>.</p>

<pre class="cli"><code>$ rake deploy
(in C:/github/vincenttam.github.io)
cp -r source/fancybox/.gitattributes public/fancybox/.gitattributes
cd _deploy
Already up-to-date.
cd -
rm -rf _deploy/404.html
...
rm -rf _deploy/stylesheets
cp -r public/. _deploy
cd _deploy
fatal: CRLF would be replaced by LF in fancybox/README.md.
On branch master
Your branch is up-to-date with 'origin/master'.
Changes not staged for commit:
        modified:   404.html
        modified:   about/index.html
        ...

Untracked files:
        blog/2016/02/21/
        blog/2016/02/22/
        downloads/code/miktex-update2/
        images/posts/MikTeXUpdate2/
        posts/31/

no changes added to commit
Everything up-to-date
cd -
## Set the codepage to 65001 for Windows machines
## Deploying branch to Github Pages
## Pulling any updates from Github Pages

## Copying public to _deploy

## Committing: Site updated at 2016-02-22 03:37:22 UTC

## Pushing generated _deploy website

## Github Pages deploy complete
</code></pre>

<p>Even though the system said that the deploy was “complete”, in fact,
it had <em>never</em> been carried out.</p>

<p><strong>How can I update my blog on GitHub Pages?</strong></p>

<!-- more -->

<h2 id="discussion">Discussion</h2>

<p>In the above error output, it took me a minute to find out <em>at which
stage</em> the deploy had failed: the line starting with “fatal”.
Therefore, I stripped off all <code>\r</code> from <code>source/fancybox/README.md</code>.
I tried deploying it again, and it <em>failed</em>—the <em>same</em> “fatal” error
appeared for <em>another file</em>.  I tried committing the change for
<code>source/fancybox/README.md</code>, but I <em>couldn’t</em> commit this.  I tried
googling “fatal crlf would be replaced by lf”, and clicked on
<a href="http://stackoverflow.com/q/20168639">the first search result</a>.  The answers in this Stack
Overflow question suggested that the option <code>core.autocrlf</code> should be
configured to <code>false</code>.  To be safe, I
<a href="https://github.com/VundleVim/Vundle.vim/wiki#win1">turned on <code>core.safecrlf</code></a>.<sup id="fnref:2"><a href="#fn:2" class="footnote">1</a></sup></p>

<p>When I <a href="/blog/2016/02/22/git-for-windows-curl-gist-dot-vim-with-vundle-1/">updated Git for Windows</a>, I chose “<strong>Checkout
Windows-style, commit Unix-style line endings</strong>” (the <em>first</em> radio
button), which the Git Setup dialog recommended.</p>

<picture class="fancybox" title="Git line conversion configuration">
  <source srcset="/images/posts/GitUpdate/autocrlf.png" media="(min-width: 505px)" />
  <img alt="Git line conversion configuration" width="300" src="https://vincenttam.github.io/images/posts/GitUpdate/autocrlf.png" />
</picture>
<p><small>Picture from <a href="http://i.stack.imgur.com/vPJCI.png">here</a>.</small></p>

<p>I love using bash utilities and (G)Vim.  In Git Bash, the former gives
LF line terminators, while the later gives CRLF.  Therefore, I decided
to <code>set fileformat=unix</code> in my VIMRC.<sup id="fnref:1"><a href="#fn:1" class="footnote">2</a></sup>  However, this <em>doesn’t</em>
unify the EOL of files in the local repository.</p>

<p>As I clone Git repositories, the line terminators are automatically
converted to CRLF.</p>

<h2 id="solution">Solution</h2>

<p><em>Completely</em> get rid of carriage returns <code>\r</code> in Git repositories!</p>

<p>To see how many files had CRLF line terminators, I tried using <code>grep</code>
in Git Bash, but <a href="http://stackoverflow.com/a/73886">this answer on Stack Overflow</a> <em>didn’t</em>
work.</p>

<pre class="cli"><code>$ find source -type f -exec grep -Iq . {} \; -and -exec dos2unix {} \;
dos2unix: converting file source/404.md to Unix format...
dos2unix: converting file source/about/index.markdown to Unix format...
dos2unix: converting file source/about/mybyobuconf.markdown to Unix format...
...
dos2unix: converting file source/_posts/2016-02-22-git-for-windows-curl-with-vun
dle-1.markdown~ to Unix format...
dos2unix: converting file source/_posts/2016-02-22-testing-octopress-and-ruby-2-
dot-0-on-windows-7-3.markdown to Unix format...
dos2unix: converting file source/_posts/2016-02-22-testing-octopress-and-ruby-2-
dot-0-on-windows-7-3.markdown~ to Unix format...
</code></pre>

<p>For the explanation of the above command, you may refer to
<a href="/blog/2015/08/22/used-more-bash-utilities/"><em>Used More Bash Utilities</em></a>.</p>

<p>After that, since <code>core.autocrlf</code> has been set to <code>false</code>, <code>git
checkout</code> no longer inserts <code>\r</code> into the files in the local
repository.  Therefore, even though <code>git status</code> reports unstaged
changes, running <code>git checkout -- source</code> <em>won’t</em> hurt the files.  I
can finally deploy the contents to GitHub Pages.<sup id="fnref:3"><a href="#fn:3" class="footnote">3</a></sup></p>

<h2 id="lessons-learnt">Lessons learnt</h2>

<p><em>Never</em> run <code>rake generate</code> nor <code>rake preview</code> in <code>cmd.exe</code>!  Run this
in Git Bash, or other shells that <em>don’t</em> give you carriage returns.</p>

<p>When a new post is created with <code>rake new_post['...']</code> in either Git
Bash or Command Prompt, the created post has DOS line endings.
Therefore, we need to take extra care with this by using <code>dos2unix</code> in
Git Bash.</p>

<hr />

<div class="footnotes">
  <ol>
    <li id="fn:2">

      <p>Refer to <a href="http://stackoverflow.com/a/1547108">this Stack Overflow question</a> for my reason
of enabling <code>core.safecrlf</code>. <a href="#fnref:2" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:1">
      <p>Refer to line 100 of my <code>_vimrc</code> at version <a href="https://goo.gl/iETw5d">07ab878</a>. <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:3">

      <p>You may verify this by comparing the line</p>

      <pre class="cli"><code>## Committing: Site updated at 2016-02-22 03:37:22 UTC
</code></pre>

      <p>in the above error message in the “Problem” section with commit
<a href="https://github.com/VincentTam/vincenttam.github.io/commits/748fbd7">748fbd7</a> on GitHub.  Due to the growth of this site, each commit
on the <code>master</code> branch now involves over 400 files and thousands
of lines of insertion and deletion.  If I provide a direct link to
the commit, it will take too long to load the page.  Therefore, I
give the commit history at a particular node instead. <a href="#fnref:3" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>
]]></content>
    
  </entry>
  
  <entry>
    
      <title type="html"><![CDATA[Git for Windows, Curl, Gist.vim With Vundle (1)]]></title>
      <link href="https://vincenttam.github.io/blog/2016/02/22/git-for-windows-curl-gist-dot-vim-with-vundle-1/"/>
    
    <updated>2016-02-22T10:23:53+08:00</updated>
    <id>https://vincenttam.github.io/blog/2016/02/22/git-for-windows-curl-gist-dot-vim-with-vundle-1</id>
    
      <content type="html"><![CDATA[<h2 id="background">Background</h2>

<p>I installed msysgit 1.9.0, and added its bash utilities to <code>PATH</code>.</p>

<h2 id="problem">Problem</h2>

<p>I attempted to open an HTML file with <code>curl</code>.  However, I got the
following error.</p>

<pre class="cli"><code>C:\Windows\system32\cmd.exe /c (curl 'http://www.vim.org/index.html' -o 'C:/Temp
/PortableApps/gVimPortable/Data/Temp/VIA1ED5.html')
curl: (1) Protocol "'http" not supported or disabled in libcurl
shell returned 1
Hit any key to close this window...
</code></pre>

<h2 id="discussion">Discussion</h2>

<p>In the first line of the code block, <code>cmd.exe</code> with option <code>/c</code> ran
the command in the parenthesis <code>()</code>.  I copied the command inside <code>()</code>
and ran it in <code>cmd.exe</code>, and the error was reproduced.</p>

<p>It’s easy to find the cause of the problem.  I typed “curl protocol”
on the Google search web page, and the rest of the error message
appeared in the list of suggestions.  In the first search result,
which was <a href="http://stackoverflow.com/q/6684235">a Stack Overflow question</a>, I learnt why this
error occurred from the first answer—in the Command Prompt, one
needs to use double quotes <code>""</code> instead of single quotes <code>''</code>.  In Git
Bash, this <em>doesn’t</em> matter.</p>

<p>Since <code>curl</code> was bundled with msysgit, I suspected that the installed
version of Git was too old.  I then upgraded it.</p>

<h2 id="lessons-learnt">Lessons learnt</h2>

<ol>
  <li>For a shell program (e.g. Command Prompt, bash), the option <code>-c</code>
(or <code>/c</code>) stands for “command”, and what’s left is the command to
be run.</li>
  <li><code>curl</code> will grab content from the input URL and display it as
standard output.  To save the downloaded content in a file, the
flag <code>-o</code>, which means “output”, can be used.</li>
</ol>

]]></content>
    
  </entry>
  
  <entry>
    
      <title type="html"><![CDATA[Testing Octopress and Ruby 2.0 on Windows 7 (3)]]></title>
      <link href="https://vincenttam.github.io/blog/2016/02/22/testing-octopress-and-ruby-2-dot-0-on-windows-7-3/"/>
    
    <updated>2016-02-22T01:05:04+08:00</updated>
    <id>https://vincenttam.github.io/blog/2016/02/22/testing-octopress-and-ruby-2-dot-0-on-windows-7-3</id>
    
      <content type="html"><![CDATA[<h2 id="background">Background</h2>

<p>I was writing <a href="/blog/2016/02/21/miktex-update-2/">my previous post</a>, which was about my recent
Mik$\rm \TeX$ update.</p>

<h2 id="problem">Problem</h2>

<p>After having finished it, I tried <code>rake generate</code>, and got results
similar to the first picture of <a href="blog/2014/09/02/testing-octopress-and-ruby-2-dot-0-on-windows-7-1/">the first post in this series</a>.</p>

<p>Last time, I solved this problem by creating the batch file
<code>python2.bat</code> in the folder where Python had been installed (i.e.
<code>C:\Python27</code>).  This time, the BAT file is already there.  In (Git)
CMD, both <code>which python</code> and <code>which python2</code> are fine.  However, in
Git bash, I run into trouble.</p>

<pre class="cli"><code>Owner@Owner-PC MINGW64 /c/github/vincenttam.github.io (source)
$ which python
/c/Python27/python

Owner@Owner-PC MINGW64 /c/github/vincenttam.github.io (source)
$ which python2
which: no python2 in (/c/Users/Owner/bin:/mingw64/bin:/usr/local/bin:/usr/bin:/b
in:/mingw64/bin:/usr/bin:/c/Users/Owner/bin:/c/ProgramData/Oracle/Java/javapath:
/c/Perl/site/bin:/c/Perl/bin:/c/Program Files (x86)/Intel/iCLS Client:/c/Program
 Files/Intel/iCLS Client:/c/Windows/system32:/c/Windows:/c/Windows/System32/Wbem
:/c/Windows/System32/WindowsPowerShell/v1.0:/c/Program Files (x86)/Intel/OpenCL 
SDK/2.0/bin/x86:/c/Program Files (x86)/Intel/OpenCL SDK/2.0/bin/x64:/c/Program F
iles (x86)/Common Files/Roxio Shared/DLLShared:/c/Program Files (x86)/Common Fil
es/Roxio Shared/OEM/DLLShared:/c/Program Files (x86)/Common Files/Roxio Shared/O
EM/DLLShared:/c/Program Files (x86)/Common Files/Roxio Shared/OEM/12.0/DLLShared
:/c/Program Files (x86)/Roxio 2010/OEM/AudioCore:/c/Program Files/Intel/Intel(R)
 Management Engine Components/DAL:/c/Program Files/Intel/Intel(R) Management Eng
ine Components/IPT:/c/Program Files (x86)/Intel/Intel(R) Management Engine Compo
nents/DAL:/c/Program Files (x86)/Intel/Intel(R) Management Engine Components/IPT
:/c/Temp/MikTeXPortable/miktex/bin:/c/MinGW/bin:/c/Temp/gnuwin32/bin:/c/ctags58:
/c/Temp/PortableApps/gVimPortable:/c/cscope-15.8a-win32rev1-static:/c/Python27:/
c/Ruby200-x64/bin:/c/Temp/pdf2svg-0.2.2:/c/Program Files (x86)/Skype/Phone:/cmd:
/usr/bin/vendor_perl:/usr/bin/core_perl)

Owner@Owner-PC MINGW64 /c/github/vincenttam.github.io (source)
$ cd /c/Python27/

Owner@Owner-PC MINGW64 /c/Python27
$ ls
DLLs/     Lib/         NEWS.txt     pythonw.exe*  Tools/
Doc/      libs/        python.exe*  README.txt    w9xpopen.exe*
include/  LICENSE.txt  python2.bat  tcl/
</code></pre>

<p>Even though the generated contents can still be locally previewed,
<strong>how can I get rid of this error message?</strong></p>

<!-- more -->

<h2 id="solution">Solution</h2>

<p>I googled “which no python2 in” (<em>with surrounding double quotes</em>),
and found one line in the post <a href="http://nathanielstory.com/2013/12/28/jekyll-on-windows-with-cygwin.html"><em>Jekyll on Windows With Cygwin</em></a>
written by Nathan Story very useful.  While reading his post, I
<em>didn’t</em> read it from the start.  Instead, I just searched for
“python2”, and quickly saw the <code>ln</code> command.</p>

<p>The file type of <code>python2</code> created by <code>ln</code> was <em>different</em> from what I
expected: <code>ls -l</code> <em>didn’t</em> show that <code>python2</code> was a symbolic link,
and <code>file</code> even said that it was an executable file.</p>

<pre class="cli"><code>Owner@Owner-PC MINGW64 /c/Python27
$ ln -s python.exe python2

Owner@Owner-PC MINGW64 /c/Python27
$ ls -l
total 677
drwxr-xr-x 1 Owner 197121      0 May 25  2014 DLLs/
drwxr-xr-x 1 Owner 197121      0 May 25  2014 Doc/
drwxr-xr-x 1 Owner 197121      0 May 25  2014 include/
drwxr-xr-x 1 Owner 197121      0 Oct  9  2014 Lib/
drwxr-xr-x 1 Owner 197121      0 May 25  2014 libs/
-rw-r--r-- 1 Owner 197121  38573 Nov 10  2013 LICENSE.txt
-rw-r--r-- 1 Owner 197121 375685 Nov 10  2013 NEWS.txt
-rwxr-xr-x 1 Owner 197121  26624 Nov 10  2013 python.exe*
-rwxr-xr-x 1 Owner 197121  26624 Nov 10  2013 python2*
-rw-r--r-- 1 Owner 197121     22 Aug 31  2014 python2.bat
-rwxr-xr-x 1 Owner 197121  27136 Nov 10  2013 pythonw.exe*
-rw-r--r-- 1 Owner 197121  55208 Oct 27  2013 README.txt
drwxr-xr-x 1 Owner 197121      0 May 25  2014 tcl/
drwxr-xr-x 1 Owner 197121      0 May 25  2014 Tools/
-rwxr-xr-x 1 Owner 197121  49664 Nov 10  2013 w9xpopen.exe*

Owner@Owner-PC MINGW64 /c/Python27
$ file python2
python2: PE32 executable (console) Intel 80386, for MS Windows
</code></pre>

<p>Finally, <code>rake</code> <em>doesn’t</em> give me strange output.</p>

]]></content>
    
  </entry>
  
  <entry>
    
      <title type="html"><![CDATA[Mik$\rm \TeX$ Update (2)]]></title>
      <link href="https://vincenttam.github.io/blog/2016/02/21/miktex-update-2/"/>
    
    <updated>2016-02-21T22:37:20+08:00</updated>
    <id>https://vincenttam.github.io/blog/2016/02/21/miktex-update-2</id>
    
      <content type="html"><![CDATA[<h2 id="background">Background</h2>

<p>I need to write something in $\rm \LaTeX$.</p>

<h2 id="problem">Problem</h2>

<p>I <em>can’t</em> get any update by clicking “Update Mik$\rm \TeX$” in the
icon triggered by <code>miktex-portable.cmd</code>.  I faced the same problem as
<a href="http://tex.stackexchange.com/q/251242">rantrave’s</a>.</p>

<!-- more -->

<h2 id="discussion">Discussion</h2>

<p>If one urgently needs to get the updated version of a particular
package, one may directly download the LZMA file.<sup id="fnref:pp1"><a href="#fn:pp1" class="footnote">1</a></sup>  Actually, the
remote package repositories are still <em>online</em>.  I guess the problem
is in Mik$\rm \TeX$ update tool.  Anyways, I am still grateful for the
effort of its developers.</p>

<h2 id="resolution">Resolution</h2>

<p>The easiest way is to sit there and <em>wait for a day</em>.  Then the
problem will be <em>gone</em>.  It is possible that some difficulties occur,
but they can be overcome.</p>

<picture class="fancybox" title="Windows API error 145">
  <source srcset="/images/posts/MikTeXUpdate2/api-err.png" media="(min-width: 460px)" />
  <img alt="Windows API error 145" width="300" src="https://vincenttam.github.io/images/posts/MikTeXUpdate2/api-err.png" />
</picture>

<p><figure class='code'><figcaption><span>I clicked “Copy Info” and got this.  (err-2016-02-22-22-00.txt)</span> <a href='/downloads/code/miktex-update2/err-2016-02-22-22-00.txt'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>MiKTeX Problem Report
</span><span class='line'>Message: Windows API error 145: The directory is not empty.
</span><span class='line'>
</span><span class='line'>Data: C:\Temp\MikTeXPortable\miktex\temp\mik8012
</span><span class='line'>Source: Libraries\MiKTeX\Core\win\winFile.cpp
</span><span class='line'>Line: 115
</span><span class='line'>MiKTeX: 2.9
</span><span class='line'>OS: Microsoft Windows 7 Home Premium Edition, 64-bit Service Pack 1 (build 7601)
</span><span class='line'>Invokers: non-existing/miktex-taskbar-icon
</span><span class='line'>SystemAdmin: no
</span><span class='line'>PowerUser: no
</span><span class='line'>Root0: C:\Temp\MikTeXPortable
</span><span class='line'>Root1: C:\localtexmf
</span><span class='line'>UserInstall: C:\Temp\MikTeXPortable
</span><span class='line'>UserConfig: C:\Temp\MikTeXPortable
</span><span class='line'>UserData: C:\Temp\MikTeXPortable
</span><span class='line'>CommonInstall: C:\Temp\MikTeXPortable
</span><span class='line'>CommonConfig: C:\Temp\MikTeXPortable
</span><span class='line'>CommonData: C:\Temp\MikTeXPortable
</span></code></pre></td></tr></table></div></figure></p>

<p>From <a href="/blog/2015/06/09/miktex-update/"><em>Mik$\rm \LaTeX$ Update</em></a>, I know that only the “Update
Mik$\rm \TeX$” in the menu triggered by clicking the small icon will
work.  The update wizard inside the big window for the package manager
<em>won’t</em>.</p>

<p>Sometimes, the chosen remote package repository can fail.  In this
case, just click the button and search for another one.</p>

<p><figure class='code'><figcaption><span>An example of failed update.  (update-2016-02-21-20-19.txt)</span> <a href='/downloads/code/miktex-update2/update-2016-02-21-20-19.txt'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>MiKTeX Update Wizard Report
</span><span class='line'>
</span><span class='line'>Version: 2.9.4913
</span><span class='line'>Date: Sunday, February 21, 2016
</span><span class='line'>Time: 20:19:02
</span><span class='line'>starting package maintenance...
</span><span class='line'>installation directory: C:\Temp\MikTeXPortable
</span><span class='line'>package repository: http://ftp.yzu.edu.tw/CTAN/systems/win32/miktex/tm/packages/
</span><span class='line'>lightweight database digest: d913ba0ad3c9c47c3e7a3e6e11863874
</span><span class='line'>going to download 6130048 bytes
</span><span class='line'>going to install 10 file(s) (1 package(s))
</span><span class='line'>going to remove 35 file(s) (4 package(s))
</span><span class='line'>downloading http://ftp.yzu.edu.tw/CTAN/systems/win32/miktex/tm/packages/miktex-bin-2.9.tar.lzma...
</span><span class='line'>6130048 bytes, 1452.65 KB/Sec
</span><span class='line'>extracting files from miktex-bin-2.9.tar.lzma...
</span><span class='line'>removing package miktex-freetype-bin-2.9...
</span><span class='line'>removing package miktex-qt4-bin-2.9...
</span><span class='line'>removing package miktex-texinfo-bin-2.9...
</span><span class='line'>removing package miktex-vc100-bin...
</span><span class='line'>
</span><span class='line'>Error: The MiKTeX package management utility could not be found.
</span></code></pre></td></tr></table></div></figure></p>

<h2 id="lessons-learnt">Lessons learnt</h2>

<p>When there’s nothing can be done, then one needs the mind of
non-action or non-being.</p>

<hr />

<div class="footnotes">
  <ol>
    <li id="fn:pp1">

      <p>For example, the situation described in
<a href="/blog/2015/06/09/miktex-update/"><em>Mik$\rm \LaTeX$ Update</em></a>. <a href="#fnref:pp1" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>
]]></content>
    
  </entry>
  
  <entry>
    
      <title type="html"><![CDATA[Git Object ID Generation (5): Predict ID]]></title>
      <link href="https://vincenttam.github.io/blog/2015/08/11/git-object-id-generation-5-predict-id/"/>
    
    <updated>2015-08-11T10:52:56+08:00</updated>
    <id>https://vincenttam.github.io/blog/2015/08/11/git-object-id-generation-5-predict-id</id>
    
      <content type="html"><![CDATA[<h2 id="goal">Goal</h2>

<p>The method for getting the Git object ID described in
<a href="/blog/2015/08/07/git-object-id-generation-4-general-trees/">previous post in this series</a> <em>isn’t</em> quick enough since it
consists of <em>several</em> commands.</p>

<h2 id="the-one-line-command">The one-line command</h2>

<h3 id="objects-with-known-git-id">Objects with known Git ID</h3>

<pre class="cliUB"><code>$ (printf "{obj_type} $(git cat-file -s {hash})\0" &amp;&amp; git cat-file {obj_type} {h
ash}) | shasum
</code></pre>

<ul>
  <li><code>{obj_type}</code> can be <code>blob</code>, <code>tree</code>, <code>commit</code> or <code>tag</code>.</li>
  <li><code>{hash}</code> is the SHA-1 hash of the object.</li>
</ul>

<p>Then the output SHA-1 hash should be the <em>same</em> as the input <code>{hash}</code>.</p>

<h3 id="predict-git-object-ids">Predict Git object IDs</h3>
<p>Hence, we can modify the above command to predict the Git object ID of
a <code>{file}</code>.</p>

<pre class="cliUB"><code>$ (printf "{obj_type} $(wc -c {file} | tr -dc '0-9')\0" &amp;&amp; cat {file}) | shasum
</code></pre>

<p>In order to verify the result for files, one can quickly get the blob
ID from Git by <code>git log -1 -p -- {file}</code>.</p>

<h2 id="facts-learnt">Facts learnt</h2>

<h3 id="extract-numbers-from-a-string-in-bash">Extract numbers from a string in bash</h3>

<p>I typed “linux extract number” on Google, and the autocompletion gave
me “from string”.  I finally saw two commands for doing this.</p>

<ol>
  <li><code>sed 's/[^0-9]//g'</code></li>
  <li><code>tr -dc '0-9'</code></li>
</ol>

<p>In my opinion, the later is simpler.  The <code>-c</code> flag takes the
complement of the characters marked by <code>-d</code>.</p>

<h3 id="using-cat-on-m-win">Using cat on M$ Win*</h3>

<p>Using the command in the section “Predict Git object IDs” gives users
a <em>wrong</em> SHA-1 sum.  The reason is that M$ Win* uses <code>\r\n</code> instead
of <code>\n</code> for starting newlines.  This also results in the <em>incorrect</em>
byte count of the files with <code>\r\n</code> as the line terminator in that
command.  Thus, the extra <code>\r</code> needs to be deleted with <code>tr -d '\r'</code>.</p>

<h3 id="using-git-for-win">Using Git for Win*</h3>

<p>For the installed version of Git on M$ Win*, one needs to use
<code>sha1sum</code> instead of <code>shasum</code>.  Otherwise, Git Bash will complain that
it is “Unable to find Digest::SHA or Digest::SHA::PurePerl”.</p>

<h3 id="using-gitportable-on-m-win">Using GitPortable on M$ Win*</h3>

<p>Since one <em>can’t</em> even issue the command <code>sha1sum</code>, use <code>openssl sha1</code>
instead.  (Omitting the trailing <code>1</code> will result in a <em>very different</em>
hexadecimal number.)</p>

]]></content>
    
  </entry>
  
</feed>
