<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Ruby | Blog 1]]></title>
  <link href="https://vincenttam.github.io/blog/categories/ruby/atom.xml" rel="self"/>
  <link href="https://vincenttam.github.io/"/>
  <updated>2016-11-01T01:48:42+01:00</updated>
  <id>https://vincenttam.github.io/</id>
  <author>
    <name><![CDATA[Vincent Tam]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    
      <title type="html"><![CDATA[Certificate Verify Failed During Gem Update]]></title>
      <link href="https://vincenttam.github.io/blog/2015/01/04/certificate-verify-failed-during-gem-update/"/>
    
    <updated>2015-01-04T15:41:05+01:00</updated>
    <id>https://vincenttam.github.io/blog/2015/01/04/certificate-verify-failed-during-gem-update</id>
    
      <content type="html"><![CDATA[<h2 id="background">Background</h2>

<p>I pull the Git commits from the <code>origin</code> of this blog to Git Bash on
M$ Win*.  The <code>Gemfile</code> has changed due to commit <a href="https://github.com/imathis/octopress/commit/fbc3c0b">fbc3c0b</a>.</p>

<h2 id="problem">Problem</h2>

<p>I ran <code>bundle install</code> according to the official documentation, and
got an <em>unexpected error</em>.<sup id="fnref:doc"><a href="#fn:doc" class="footnote">1</a></sup></p>

<pre class="cli"><code><span class="GitHostName">Owner@OWNER-PC</span> <span class="GitPathName">/c/github/vincenttam.github.io (source)</span>
$ bundle install
DL is deprecated, please use Fiddle
Fetching gem metadata from https://rubygems.org/.........
Resolving dependencies...
<span class="err">Bundler could not find compatible versions for gem "sass":
  In snapshot (Gemfile.lock):
    sass (3.2.19)

  In Gemfile:
    compass (~&gt; 1.0.1) x64-mingw32 depends on
      sass (&lt; 3.5, &gt;= 3.3.13) x64-mingw32</span>

Running `<span class="HLCode">bundle update</span>` will rebuild your snapshot from scratch, using only
the gems in your Gemfile, which may resolve the conflict.
</code></pre>

<p><em>Without</em> updated gems, even though everything in the <code>source</code> folder
is <em>correct</em>, one <em>can’t</em> generate an Octopress blog.  <strong>How can one
get the gems updated?</strong></p>

<!-- more -->

<p>I then tried to follow the suggestion, but received <em>another</em> error.</p>

<pre class="cli"><code><span class="GitHostName">Owner@OWNER-PC</span> <span class="GitPathName">/c/github/vincenttam.github.io (source)</span>
Owner@OWNER-PC /c/github/vincenttam.github.io (source)
$ bundle update
DL is deprecated, please use Fiddle
Fetching gem metadata from https://rubygems.org/.........
Resolving dependencies...

<span class="err">Gem::RemoteFetcher::FetchError: SSL_connect returned=1 errno=0 state=SSLv3 read
server certificate B: certificate verify failed (https://rubygems.org/gems/rake-
10.4.2.gem)
An error occurred while installing rake (10.4.2), and Bundler cannot continue.
Make sure that `<span class="HLCode">gem install rake -v '10.4.2'</span>` succeeds before bundling.</span>
</code></pre>

<p>I ran the <strong>command in bold</strong> in the above message, and got <em>similar</em>
messages.</p>

<pre class="cli"><code><span class="GitHostName">Owner@OWNER-PC</span> <span class="GitPathName">/c/github/vincenttam.github.io (source)</span>
$ gem install rake -v '10.4.2'
<span class="err">ERROR:  Could not find a valid gem 'rake' (= 10.4.2), here is why:
          Unable to download data from https://rubygems.org/ - SSL_connect retur
ned=1 errno=0 state=SSLv3 read server certificate B: certificate verify failed (
https://rubygems.org/specs.4.8.gz)</span>
</code></pre>

<h2 id="solution">Solution</h2>

<p>I googled “windows unable to download data from https //rubygems.org/
- ssl_connect returned=1”, and clicked on the
<a href="https://stackoverflow.com/q/19150017" title="SSL Error When installing rubygems, Unable to pull data ...">first Stack Overflow question that I saw</a>.  I quickly
skimmed through the first answer of this question, and read the last
section “Windows note”, which referred interested readers to two
places:</p>

<ol>
  <li>RubyInstaller issue <a href="https://github.com/oneclick/rubyinstaller/issues/249" title="Change OpenSSL certificates path">249</a> on GitHub,</li>
  <li>The second answer of this question.</li>
</ol>

<p>I clicked the first webpage, and quickly jumped to
<a href="https://gist.github.com/luislavena/f064211759ee0f806c88" title="SSL upgrades on rubygems.org and RubyInstaller versions">Luis Lavena’s response</a> to the issue.  Unlike the previous
webpages, I read every word from the beginning to the third section
this time, and read the Stack Overflow question again, before deciding
what to be done.</p>

<p>I followed the instructions in the third section, instead of manually
downloading and inserting the PEM file back to the folder which the
command <code>gem which rubygems</code> returned.</p>

<pre class="cli"><code><span class="GitHostName">Owner@OWNER-PC</span> <span class="GitPathName">/c/github/vincenttam.github.io (source)</span>
$ gem install --local ~/Downloads/rubygems-update-2.0.15.gem
Successfully installed rubygems-update-2.0.15
Parsing documentation for rubygems-update-2.0.15
Installing ri documentation for rubygems-update-2.0.15
1 gem installed

<span class="GitHostName">Owner@OWNER-PC</span> <span class="GitPathName">/c/github/vincenttam.github.io (source)</span>
$ update_rubygems --no-ri --no-rdoc
RubyGems 2.0.15 installed

=== 2.0.14 / 2013-11-12

Bug fixes:

* Restore concurrent requires following the fix for ruby bug #8374.  Pull
  request #637 and issue #640 by Charles Nutter.
* Gem::Specification::remove_spec no longer checks for existence of the spec
  to be removed.  Issue #698 by Tiago Macedo.
* Restored wildcard handling when installing gems.  Issue #697 by Chuck Remes.
* Added DigiCert High Assurance EV Root CA certificate for the cloudfront.net
  certificate change.
* The Gem::RemoteFetcher tests now choose the test server port more reliably.
  Pull Request #706 by akr.


------------------------------------------------------------------------------

RubyGems installed the following executables:
        c:/Ruby200-x64/bin/gem

<span class="GitHostName">Owner@OWNER-PC</span> <span class="GitPathName">/c/github/vincenttam.github.io (source)</span>
$ gem uninstall rubygems-update -x
Removing update_rubygems
Successfully uninstalled rubygems-update-2.0.15
</code></pre>

<p>Then I ran <code>bundle install</code> <em>again</em>, and I still got the <em>same</em> error
shown at the very beginning of the post.  However, I <em>could</em> update the
gems.</p>

<pre class="cli"><code><span class="GitHostName">Owner@OWNER-PC</span> <span class="GitPathName">/c/github/vincenttam.github.io (source)</span>
$ bundle update
DL is deprecated, please use Fiddle
Fetching gem metadata from https://rubygems.org/.........
Resolving dependencies...
<span class="HLCode">Installing rake 10.4.2 (was 10.3.2)</span>
Using RedCloth 4.2.9
Using blankslate 2.1.2.4
Installing hitimes 1.2.2
Installing timers 4.0.1 (was 1.1.0)
Installing celluloid 0.16.0 (was 0.15.2)
Installing chunky_png 1.3.3 (was 1.3.1)
Using fast-stemmer 1.0.2
Installing classifier-reborn 2.0.3 (was 2.0.1)
Using coffee-script-source 1.8.0
Installing execjs 2.2.2 (was 2.2.1)
Using coffee-script 2.3.0
Using colorator 0.1
Installing multi_json 1.10.1
Installing sass 3.4.9 (was 3.2.19)
Installing compass-core 1.0.1
Installing compass-import-once 1.0.5
Using rb-fsevent 0.9.4
Installing ffi 1.9.6 (was 1.9.3)
Using rb-inotify 0.9.5
Installing compass 1.0.1 (was 0.12.7)
Using tilt 1.4.1
Installing haml 4.0.6 (was 4.0.5)
Installing jekyll-coffeescript 1.0.1 (was 1.0.0)
Using jekyll-gist 1.1.0
Installing jekyll-paginate 1.1.0 (was 1.0.0)
Installing jekyll-sass-converter 1.3.0 (was 1.2.0)
Installing listen 2.8.4 (was 2.7.9)
Installing jekyll-watch 1.2.0 (was 1.1.0)
Installing kramdown 1.5.0 (was 1.4.1)
Using liquid 2.6.1
Installing mercenary 0.3.5 (was 0.3.4)
Using posix-spawn 0.3.9
Using yajl-ruby 1.1.0
Using pygments.rb 0.6.0
Installing redcarpet 3.2.2 (was 3.1.2)
Installing safe_yaml 1.0.4 (was 1.0.3)
Using parslet 1.5.0
Installing toml 0.1.2 (was 0.1.1)
Installing jekyll 2.5.3 (was 2.3.0)
Installing jekyll-sitemap 0.7.0 (was 0.5.1)
Installing octopress-hooks 2.2.3 (was 2.2.1)
Installing octopress-date-format 2.0.2 (was 2.0.1)
Installing rack 1.6.0 (was 1.5.2)
Using rack-protection 1.5.3
Using rubypants 0.2.0
Using sass-globbing 1.0.0
Using sinatra 1.4.5
Using stringex 1.4.0
Using wdm 0.1.0
Using bundler 1.7.2
<span class="HLCode">Your bundle is updated!</span>
</code></pre>

<h2 id="lessons-learnt">Lessons learnt</h2>

<p>To save space in the hard disk, I removed the old versions of gems
with a short and simple command.</p>

<pre class="cli"><code><span class="GitHostName">Owner@OWNER-PC</span> <span class="GitPathName">/c/github/vincenttam.github.io (source)</span>
$ gem cleanup
Cleaning up installed gems...
Attempting to uninstall rake-10.3.2
Successfully uninstalled rake-10.3.2
Attempting to uninstall rack-1.5.2
Successfully uninstalled rack-1.5.2
Attempting to uninstall octopress-date-format-2.0.1
Successfully uninstalled octopress-date-format-2.0.1
Attempting to uninstall octopress-hooks-2.2.1
Successfully uninstalled octopress-hooks-2.2.1
Attempting to uninstall jekyll-sitemap-0.5.1
Successfully uninstalled jekyll-sitemap-0.5.1
Attempting to uninstall jekyll-2.3.0
Successfully uninstalled jekyll-2.3.0
Attempting to uninstall jekyll-watch-1.1.0
Successfully uninstalled jekyll-watch-1.1.0
Attempting to uninstall listen-2.7.9
Successfully uninstalled listen-2.7.9
Attempting to uninstall jekyll-sass-converter-1.2.0
Successfully uninstalled jekyll-sass-converter-1.2.0
Attempting to uninstall jekyll-coffeescript-1.0.0
Successfully uninstalled jekyll-coffeescript-1.0.0
Attempting to uninstall jekyll-paginate-1.0.0
Successfully uninstalled jekyll-paginate-1.0.0
Attempting to uninstall toml-0.1.1
Successfully uninstalled toml-0.1.1
Attempting to uninstall redcarpet-3.1.2
Successfully uninstalled redcarpet-3.1.2
Attempting to uninstall safe_yaml-1.0.3
Successfully uninstalled safe_yaml-1.0.3
Attempting to uninstall mercenary-0.3.4
Successfully uninstalled mercenary-0.3.4
Attempting to uninstall kramdown-1.4.1
Successfully uninstalled kramdown-1.4.1
Attempting to uninstall haml-4.0.5
Successfully uninstalled haml-4.0.5
Attempting to uninstall ffi-1.9.3-x64-mingw32
Successfully uninstalled ffi-1.9.3-x64-mingw32
Attempting to uninstall execjs-2.2.1
Successfully uninstalled execjs-2.2.1
Attempting to uninstall compass-0.12.7
Successfully uninstalled compass-0.12.7
Attempting to uninstall classifier-reborn-2.0.1
Successfully uninstalled classifier-reborn-2.0.1
Attempting to uninstall chunky_png-1.3.1
Successfully uninstalled chunky_png-1.3.1
Attempting to uninstall celluloid-0.15.2
Successfully uninstalled celluloid-0.15.2
Attempting to uninstall timers-1.1.0
Successfully uninstalled timers-1.1.0
Attempting to uninstall sass-3.2.19
Successfully uninstalled sass-3.2.19
<span class="HLCode">Clean Up Complete</span>
</code></pre>

<hr />

<div class="footnotes">
  <ol>
    <li id="fn:doc">
      <p><a href="http://octopress.org/docs/updating/">Updating Octopress</a> in <em>Octopress Documentation</em>. <a href="#fnref:doc" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>
]]></content>
    
  </entry>
  
  <entry>
    
      <title type="html"><![CDATA[Installed Prawn]]></title>
      <link href="https://vincenttam.github.io/blog/2014/11/03/installed-prawn/"/>
    
    <updated>2014-11-03T05:21:34+01:00</updated>
    <id>https://vincenttam.github.io/blog/2014/11/03/installed-prawn</id>
    
      <content type="html"><![CDATA[<h2 id="problem">Problem</h2>

<p>This noon, I tried to use the <a href="http://kramdown.gettalong.org/documentation.html#usage">kramdown</a> command line utility to
generate PDF files, but failed.</p>

<pre class="cliUB"><code>$ kramdown test.tex -o pdf &gt; test.pdf
/home/owner/.rvm/rubies/ruby-2.1.2/lib/ruby/site_ruby/2.1.0/rubygems/core_ext/ke
rnel_require.rb:55:in `require': cannot load such file -- prawn (LoadError)
	from /home/owner/.rvm/rubies/ruby-2.1.2/lib/ruby/site_ruby/2.1.0/rubygem
s/core_ext/kernel_require.rb:55:in `require'
	from /home/owner/.rvm/gems/ruby-2.1.2/gems/kramdown-1.4.1/lib/kramdown/c
onverter/pdf.rb:10:in `&lt;top (required)&gt;'
	from /home/owner/.rvm/gems/ruby-2.1.2/gems/kramdown-1.4.1/lib/kramdown/d
ocument.rb:119:in `const_defined?'
	from /home/owner/.rvm/gems/ruby-2.1.2/gems/kramdown-1.4.1/lib/kramdown/d
ocument.rb:119:in `method_missing'
	from /home/owner/.rvm/gems/ruby-2.1.2/gems/kramdown-1.4.1/bin/kramdown:6
1:in `block in &lt;top (required)&gt;'
	from /home/owner/.rvm/gems/ruby-2.1.2/gems/kramdown-1.4.1/bin/kramdown:6
1:in `each'
	from /home/owner/.rvm/gems/ruby-2.1.2/gems/kramdown-1.4.1/bin/kramdown:6
1:in `&lt;top (required)&gt;'
	from /home/owner/.rvm/gems/ruby-2.1.2/bin/kramdown:23:in `load'
	from /home/owner/.rvm/gems/ruby-2.1.2/bin/kramdown:23:in `&lt;main&gt;'
	from /home/owner/.rvm/gems/ruby-2.1.2/bin/ruby_executable_hooks:15:in `e
val'
	from /home/owner/.rvm/gems/ruby-2.1.2/bin/ruby_executable_hooks:15:in `&lt;
main&gt;'
</code></pre>

<!-- more -->

<h2 id="attempt">Attempt</h2>

<p>I searched Google for “kramdown pdf”, and find
<a href="http://stackoverflow.com/a/4377892" title="How to generate PDF from markdown using pure ruby">this question</a> useful.  It linked to a page introducing
<a href="http://prawn.majesticseacreature.com/">Prawn</a>.</p>

<p>I used the testing code there to figure out that the above problem had
arised because I <em>didn’t</em> install the Ruby gem.</p>

<pre class="cliUB"><code>$ gem install prawn
Fetching: ttfunk-1.4.0.gem (100%)
Successfully installed ttfunk-1.4.0
Fetching: pdf-core-0.4.0.gem (100%)
Successfully installed pdf-core-0.4.0
Fetching: prawn-1.3.0.gem (100%)

  ********************************************


  A lot has changed recently in Prawn.

  Please read the changelog for details:

  https://github.com/prawnpdf/prawn/wiki/CHANGELOG


  ********************************************

Successfully installed prawn-1.3.0
3 gems installed
</code></pre>

<p>But I still <em>can’t</em> run the sample code correctly.  Finally, I use
<a href="http://johnmacfarlane.net/pandoc/">pandoc</a>.</p>

]]></content>
    
  </entry>
  
  <entry>
    
      <title type="html"><![CDATA[Install Ruby Again! (2)]]></title>
      <link href="https://vincenttam.github.io/blog/2014/08/13/install-ruby-again-2/"/>
    
    <updated>2014-08-13T14:26:05+02:00</updated>
    <id>https://vincenttam.github.io/blog/2014/08/13/install-ruby-again-2</id>
    
      <content type="html"><![CDATA[<p>I installed Ruby 2.1.2 so as to build Octopress on top of it.
Luckily, the installation was successful.</p>

<p><img src="/images/posts/Ruby212/rvm-install.png" alt="Installed Ruby 2.1.2 in the terminal" /></p>

<p>This afternoon, I tried running <code>rake</code> on Ruby 2.1.2.  Unluckily, I
failed.</p>

<!-- more -->

<p><img src="/images/posts/Ruby212/gen-failed.png" alt="`rake generate` failed" /></p>

<p>The above problem could be fixed by simply changing <code>nil</code> to <code>null</code> at
the second line of <code>source/_includes/custom/category_feed.xml</code>, so
it’s <em>not</em> really a problem.</p>

<p>First, the image popup plugin complained about the new version of gems.</p>

<p>I tried to replace all <code>imgpopup</code> by <code>img</code> to find further problems
first.</p>

<pre class="cli"><code class="UBMono">[owner@localhost ~/octopress]$ rake generate
## Generating Site with Jekyll
<span class="rake_gen_unchanged">unchanged</span> sass/print.scss
<span class="rake_gen_identical">identical</span> source/stylesheets/screen.css 
Configuration file: /home/owner/octopress/_config.yml
            Source: source
       Destination: public
      Generating... 
<span class="err">Liquid Exception: undefined method `safe_wrap' for #&lt;&lt;Jekyll::ImgPopup:0xa45c82
4&gt;&gt; in _posts/2013-08-16-edit-latex-equations-in-vim.html/#excerpt</span>
jekyll 2.3.0 | Error:  undefined method `safe_wrap' for #&lt;&lt;Jekyll::ImgPopup:0xa4
5c824&gt;&gt;
</code></pre>

<p>Second, it’s the <code>gsub</code> method <em>again</em>!  I’m sorry to that I has been
tired of reading Ruby’s documentation, so I decided to reset my commit
history to the tip of <code>origin/source</code>, and revert the default RVM
version to 1.9.3 <em>again</em> by <code>rvm use --default 1.9.3</code>.</p>

]]></content>
    
  </entry>
  
  <entry>
    
      <title type="html"><![CDATA[Fixing Broken URLs in the Catetory List]]></title>
      <link href="https://vincenttam.github.io/blog/2014/06/20/fixing-broken-urls-in-the-catetory-list/"/>
    
    <updated>2014-06-20T17:51:06+02:00</updated>
    <id>https://vincenttam.github.io/blog/2014/06/20/fixing-broken-urls-in-the-catetory-list</id>
    
      <content type="html"><![CDATA[<p>(Added on AUG 20, 2014)</p>

<p>Since the update of Octopress source code, this post <em>won’t</em> make
sense anymore.  I <em>can’t</em> find a way to use MathJax in category list
entries anymore because <code>category</code> in <code>plugins/category_generator.rb</code>
and <code>plugins/category_list_tag.rb</code> have both been changed to <em>lower
case</em>.  I <em>don’t</em> know how to track the Ruby code to revert it.</p>

<!-- more -->

<h2 id="background">Background</h2>

<p>I imported some posts in <a href="https://blogue.wordpress.com/">my old blog on WordPress.com</a>,
and some categories like “$\rm \LaTeX$-Suite” <em>weren’t</em> displayed
properly.  Moreover, the link for some categories like “C/C++” was
<em>dead</em> in <a href="http://www.dotnetguy.co.uk/post/2012/06/25/octopress-category-list-plugin/">Watson’s Category List Plugin</a>.</p>

<p><img class="fancybox" src="/images/posts/CatList/CatList404.png" width="800" title="‘Dead links in category list’ ‘fig1’" ></p>

<p>Unlike two months ago<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup>, I now think that it’s better for me to find
out why the catergory list <em>failed</em> to generate a correct URL for a
category page, but the default links for category pages in the blog
archive are <em>right</em>.</p>

<p><img class="fancybox" src="/images/posts/CatList/CatListURL.png" width="800" title="‘Correct links in blog archive’ ‘fig2’" ></p>

<p>I certainly know the precise location of the part of
<code>plugins/category_list_tag.rb</code> that has generated the <em>erroneous</em>
links for some category pages.</p>

<pre><code>category_url = File.join(category_dir, category.gsub(/_|\P{Word}/, '-').gsub(/-{2,}/, '-').downcase)
</code></pre>

<h2 id="finding-the-solution">Finding the solution</h2>

<p>I tried to browse the code in <code>plugins/category_generator.rb</code> to find
out Octopress’s way of generating the URL of categories and what’s
wrong with the above method to extract <code>category_url</code>.</p>

<p>At the beginning, I saw <code>category_dir</code>, and used <code>*</code> and <code>n</code> in Vim to
explore the script.  I did so because in
<code>plugins/category_list_tag.rb</code>, <code>category_dir</code> was a part of
<code>category_url</code>.  I jumped through the <code>category_dir</code>s for a few times
since they <em>weren’t</em> related to the generation of the URL for a
category page.  When the cursor was at line 109, I discovered the word
<code>category.to_url</code>. I typed <code>*</code> on <code>to_url</code>, and was brought to line
176.  This <code>category.to_url</code> was in <code>category_link</code> method.  From the
<code>&lt;a&gt;</code> tag inside this method, I’m sure that I should give <code>to_url</code> a
try.</p>

<pre><code>"&lt;a class='category' href='https://vincenttam.github.io/#{dir}/#{category.to_url}/'&gt;#{category}&lt;/a&gt;"
</code></pre>

<h2 id="verifying-my-guess">Verifying my guess</h2>

<p>To test if my guess is correct, I used to most primitive method for
debugging: insert <code>puts category + ": " + category.to_url</code> below the
line that defined <code>category_url</code> in <code>plugins/category_list_tag.rb</code>.
After that, I generated and previewed the site.</p>

<p>For the terminal output, I could see that <code>catergory</code> was the name of
the a category, while <code>category_url</code> was part of the correct URL for
a category page.  Therefore, in <code>plugins/category_list_tag.rb</code>, the
method that generated <code>category_url</code> should be changed like this:</p>

<pre><code>category_url = File.join(category_dir, category.to_url)
</code></pre>

<hr />

<div class="footnotes">
  <ol>
    <li id="fn:1">

      <p>Last month, I used a specfic way to get things work.</p>

      <p><blockquote><p>As I am not going to spend most of my time to study IT, I aimed at merely changing “LaTeX” to “$\rm \LaTeX$”.</p><footer><strong>Me</strong> <cite><a href='https://vincenttam.github.io/blog/2014/05/24/using-mathjax-in-category-list-entries/'>Using MathJax in Category List Entries</a></cite></footer></blockquote> <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>
]]></content>
    
  </entry>
  
  <entry>
    
      <title type="html"><![CDATA[My Settings for RSS (2)]]></title>
      <link href="https://vincenttam.github.io/blog/2014/06/11/my-settings-for-rss-2/"/>
    
    <updated>2014-06-11T15:08:01+02:00</updated>
    <id>https://vincenttam.github.io/blog/2014/06/11/my-settings-for-rss-2</id>
    
      <content type="html"><![CDATA[<p>Note: I	<em>don’t</em> use <a href="http://brizzled.clapper.org/blog/2012/02/05/a-simple-octopress-image-popup-plugin/" title="A Simple Octopress Image Popup Plugin">Clapper’s image popup plugin</a> anymore,
so the settings below are now gone.</p>

<h2 id="background">Background</h2>

<p>Using the following plugin, I finished removing the repeating figures
in my Atom Feed.<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup></p>

<p><figure class='code'><figcaption><span>Erv Walter’s plugin with my modifications</span><a href='http://www.ewal.net/2012/09/08/octopress-customizations/#remove-line-numbers-in-atom-feed'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">CustomLiquidFilters</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">remove_linenumbers</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
</span><span class='line'>    <span class="n">input</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/&amp;lt;td\ class=”gutter”&amp;gt;.+?&amp;lt;\/td&amp;gt;/m</span><span class="p">,</span> <span class="err">‘</span> <span class="err">‘</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;RegexMap = {</span>
</span><span class='line'><span class="sr">    /</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">div</span><span class="p">\</span> <span class="n">class</span><span class="o">=</span><span class="err">”</span><span class="n">caption</span><span class="err">”</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="no">Click</span> <span class="n">the</span> <span class="n">image</span> <span class="k">for</span> <span class="n">a</span> <span class="n">larger</span> <span class="n">view</span><span class="o">.</span><span class="n">&amp;lt</span><span class="p">;\</span><span class="o">/</span><span class="n">div</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">/</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="err">‘’</span><span class="p">,</span>
</span><span class='line'>    <span class="sr">/&amp;lt;div\ id=”image-dialog-\d+”.*?&amp;gt;.+?&amp;lt;\/div&amp;gt;/m</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="err">‘’</span><span class="p">,</span>
</span><span class='line'>    <span class="sr">/&amp;lt;div\ class=”illustration\ print”&amp;gt;.+?&amp;lt;\/div&amp;gt;/m</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="err">‘’</span><span class="p">,</span>
</span><span class='line'>  <span class="p">}</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;def remove_bigfig(input)</span>
</span><span class='line'><span class="sr">    RegexMap.each_pair {|k,v| input.gsub!(k, v)}</span>
</span><span class='line'><span class="sr">    input</span>
</span><span class='line'><span class="sr">  end</span>
</span><span class='line'><span class="sr">end&lt;/</span><span class="nb">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span><span class="no">Liquid</span><span class="o">::</span><span class="no">Template</span><span class="o">.</span><span class="n">register_filter</span> <span class="no">CustomLiquidFilters</span>
</span></code></pre></td></tr></table></div></figure></p>

<h2 id="problem">Problem</h2>

<p><strong>How about category Atom Feeds?</strong></p>

<p>It took me some time a find out that the file needed to be changed was
<code>source/_includes/custom/category_feed.xml</code>.  In that file, I tried to
do the same modification like what I had already did in
<code>source/atom.xml</code>.</p>

<p><figure class='code'><figcaption><span>My initial attempt to solve the problem in category feed page</span><a href='/blog/2014/06/10/my-settings-for-rss-1/#putting-things-together'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;/p&gt;</span>
</span><span class='line'><span class="nt">&lt;entry&gt;</span>
</span><span class='line'>  <span class="c">&lt;!-- other elements --&gt;</span>
</span><span class='line'>  <span class="nt">&lt;content</span> <span class="na">type=</span><span class="s">&quot;html&quot;</span><span class="nt">&gt;</span><span class="ni">&amp;lt;</span>![CDATA[{{ post.content | remove_linenumbers | remove_bigfig | expand_urls: site.url | markdownify | cdata_escape }}]]<span class="ni">&amp;gt;</span><span class="nt">&lt;/content&gt;</span>
</span><span class='line'><span class="nt">&lt;/entry&gt;</span>
</span><span class='line'><span class="nt">&lt;p&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Then I generated the site <em>without</em> getting any errors.  However, when
I was previewing one of my category Atom Feeds, I found out that the
above changes to the XML had did <em>nothing</em>—the popup images still
appeared <em>twice</em>.</p>

<!-- more -->

<h2 id="exploring-the-default-jekyll-code">Exploring the default Jekyll code</h2>

<p>I tried deleting my custom filter <code>remove_bigfig</code>, so that I could
test whether <a href="http://www.ewal.net/2012/09/08/octopress-customizations/#remove-line-numbers-in-atom-feed" title="Remove line numbers in Atom Feed">Walter’s instructions for removing line numbers</a>
worked for category Atom Feeds.  Unfortunately, his method failed.</p>

<p>Having <em>no</em> knowledge in how the XML file actually worked, I broke
things down by deleting the word <code>markdownify</code>, as well as
<code>remove_bigfig</code>, in order to see how things worked.  Then I saw
markdown code at <code>localhost:4000</code>.  It means that <code>markdownify</code>
converts markdown to HTML.  Thus, I tried to insert the word
<code>remove_bigfig</code> again just after <code>markdownify</code>, but I <em>still</em> saw the
same popup image appearing twice.</p>

<p>Since Walter’s steps didn’t work for me, I almost wanted to give it
up.</p>

<p>In the morning two days ago, I suddenly realized that I could write
see what’s going on inside Octopress by getting the standard output.
<em>Not</em> going take an online tutorial about using Ruby debugger, I used
the most primitive way of debugging.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">debug</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">input</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>I recorded the output into a file and then browsed through it.  I
found the <code>imgpopup ...</code> inside the file.
I also viewed the source code of <code>cdata_escape</code> so that I knew what
the function did: HTML encode the only argument.  I compared the
output before and after <code>cdata_escape</code>, and <em>couldn’t</em> see any
difference.  Then it’s clear that using an HTML tag for a regular
expression match <em>wasn’t</em> feasible—change it back to Octopress’s image
tag instead.</p>

<h2 id="ruby-code-learnt">Ruby code learnt</h2>

<ul>
  <li><code>body.gsub!(/(?=\b).+(?=\b)/) {|m| subs[m]}</code> from
  <a href="http://stackoverflow.com/a/17766326" title="Can I use gsub and Hashes in Ruby?">Stack Overflow</a>.
    <ul>
      <li><code>/(?&lt;=\b)/</code> <em>didn’t</em> work, since Perl and Ruby didn’t allow
  variable-length patterns.</li>
      <li>This is for an array of Strings, <em>not</em> a long String.</li>
    </ul>
  </li>
  <li><code>map</code> and <code>collect</code> methods in Array class are the <em>same</em>.</li>
  <li><code>each</code> and <code>each_pair</code> methods in Hash class are <em>different</em>.</li>
</ul>

<h2 id="an-illusory-success">An illusory success</h2>

<p>I wrote a function, and pushed it onto GitHub.<sup id="fnref:2"><a href="#fn:2" class="footnote">2</a></sup>  Viewing the site,
I could see that I successfully change the popup images into ordinary
ones in the category Atom Feed.  However, these changes were <em>also</em>
applied to my blog posts.<sup id="fnref:3"><a href="#fn:3" class="footnote">3</a></sup>  I thought that the error was due to the
use of <code>gsub!</code>, instead of <code>gsub</code>.</p>

<h2 id="new-version-of-my-custom-filter">New version of my custom filter</h2>

<p>I’ve been tired of studying code and reading documentations.
Therefore, I just adopted an ugly approach—input <code>.gsub(...)</code> for
<em>multiple</em> times.  Eventually, I got the desired output.</p>

<hr />

<div class="footnotes">
  <ol>
    <li id="fn:1">

      <p>For details, you may refer to <a href="/blog/2014/06/10/my-settings-for-rss-1/" title="My Settings for RSS (1)">my post about RSS</a>
written yesterday. <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p><code>source/plugins/custom_filter.rb</code> at commit <a href="https://github.com/VincentTam/vincenttam.github.io/blob/449a911/plugins/custom_filter.rb#L18-L26">449a911</a> <a href="#fnref:2" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:3">

      <p><code>source/blog/2014/03/22/jump-to-latex-syntax-error/index.html</code> at
commit <a href="https://github.com/VincentTam/vincenttam.github.io/commit/fad55d6#diff-1">fad55d6</a> <a href="#fnref:3" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>
]]></content>
    
  </entry>
  
</feed>
