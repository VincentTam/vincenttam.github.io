<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Sql | Blog 1]]></title>
  <link href="https://vincenttam.github.io/blog/categories/sql/atom.xml" rel="self"/>
  <link href="https://vincenttam.github.io/"/>
  <updated>2016-04-09T18:30:37+08:00</updated>
  <id>https://vincenttam.github.io/</id>
  <author>
    <name><![CDATA[Vincent Tam]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    
      <title type="html"><![CDATA[Improve Efficiency of Inner Join]]></title>
      <link href="https://vincenttam.github.io/blog/2016/01/07/improve-efficiency-of-inner-join/"/>
    
    <updated>2016-01-07T18:38:44+08:00</updated>
    <id>https://vincenttam.github.io/blog/2016/01/07/improve-efficiency-of-inner-join</id>
    
      <content type="html"><![CDATA[<h2 id="background">Background</h2>

<p>I search the data on <a href="http://data.stackexchange.com">Stack Exchange Data Explorer</a>.</p>

<h2 id="problem">Problem</h2>

<p>I want to select columns from two tables and join them to form one
single table.  I choose <code>INNER JOIN</code> to avoid seeing null entries in
the result.  The syntax is similar to the following.</p>

<p>{% codeblock Sample SQL Syntax lang:sql %}
SELECT * FROM Table1
INNER JOIN Table2
ON Table1.ID = Table2.ID
WHERE Col1 LIKE ‘foo’
{% endcodeblock %}</p>

<p>Unluckily, when the size of <code>Table1</code> and <code>Table2</code> is large, it takes a
while to get the result.</p>

<h2 id="solution">Solution</h2>

<p><a href="https://goo.gl/iLGa5Z">This page</a> has two more efficient ways.  Since I search for
recent data, I adopted the third method in <a href="http://data.stackexchange.com/math/query/416590/view-all-unanswered-questions">my query</a>.</p>

<p>{% codeblock My Query on Stack Exchange Data Explorer lang:sql %}
DECLARE @TagLike NVARCHAR(25) = ##taglike:string##</p>

<p>SELECT TOP 500 * FROM (SELECT Id AS [Post Link], AnswerCount AS [Ans],
CommentCount AS [Com], CreationDate, Score AS [Scr],
ViewCount AS [Views], OwnerUserId FROM Posts
WHERE AnswerCount = 0 AND Tags LIKE ‘%’ + @TagLike + ‘%’ AND
ClosedDate IS NULL) AS p
INNER JOIN (SELECT Id, LastAccessDate, Reputation AS [Rep] FROM Users
WHERE LastAccessDate &gt;= ‘2015-12-01’) AS u
ON p.OwnerUserId = u.Id
ORDER BY p.Com
{% endcodeblock %}</p>

]]></content>
    
  </entry>
  
  <entry>
    
      <title type="html"><![CDATA[Distribution of User Reputation on Math Stack Exchange]]></title>
      <link href="https://vincenttam.github.io/blog/2016/01/07/distribution-of-user-reputation-on-math-stack-exchange/"/>
    
    <updated>2016-01-07T17:34:38+08:00</updated>
    <id>https://vincenttam.github.io/blog/2016/01/07/distribution-of-user-reputation-on-math-stack-exchange</id>
    
      <content type="html"><![CDATA[<h2 id="background">Background</h2>

<p>Recently, I post math on <a href="http://math.stackexchange.com">Mathematics Stack Exchange</a> instead
of here.</p>

<h2 id="problem">Problem</h2>

<p>How can one get a table for the distribution of reputation on that
site?</p>

<h2 id="solution">Solution</h2>

<p>Write a SQL query on <a href="http://data.stackexchange.com">Stack Exchange Data Explorer</a>.</p>

<p>{% codeblock User’s Total Reputation Distribution lang:sql http://goo.gl/Kqwepp %}
select u.range as [prev row &lt;= Reputation &lt;= this row], count(*) as [Users]
from (
    select case
    when Reputation between 1 and 4 then 4
    when Reputation between 5 and 9 then 9
    when Reputation between 10 and 14 then 14
    when Reputation between 15 and 19 then 19
    when Reputation between 20 and 49 then 49
    when Reputation between 50 and 74 then 74
    when Reputation between 75 and 99 then 99
    when Reputation between 100 and 124 then 124
    when Reputation between 125 and 249 then 249
    when Reputation between 250 and 499 then 499
    when Reputation between 500 and 999 then 999
    when Reputation between 1000 and 1999 then 1999
    when Reputation between 2000 and 2499 then 2499
    when Reputation between 2500 and 2999 then 2999
    when Reputation between 3000 and 4999 then 4999
    when Reputation between 5000 and 9999 then 9999
    when Reputation between 10000 and 14999 then 14999
    when Reputation between 15000 and 19999 then 19999
    when Reputation between 20000 and 24999 then 24999
    else 400000 end as range
        from Users) u
    group by u.range
{% endcodeblock %}</p>

<p>The indentation is automatically done by <a href="http://www.vim.org">Vim</a>.  I know that the
syntax is <em>ugly</em>.  If I assign text string to the column <code>u.range</code>,
then the table is sorted in <em>alphabetical order</em> of that column
instead of numerical order.  This <em>doesn’t</em> make sense.  Therefore, I
use a dirty way to get the statistics, and played with the built-in
graphing function.  However, the visual result <em>isn’t</em> so
satisfactory.</p>

<p>{% img fancybox /images/posts/MathSE/reputation985.png 300 ‘Reputation v.s. Users on Math Stack Exchange’ ‘MathSE reputation statistics’ %}</p>

<p>Anyone who has completed high school will realise that a log graph is
better.  Asking for this feature on <a href="http://meta.stackexchange.com">Meta Stack Exchange</a>
takes time.  I believe that such feature request will be rejected by
the moderator to reduce the workload of Stack Exchange company.
Therefore, I plot the log graph using <a href="https://www.gnu.org/software/octave">GNU Octave</a>.</p>

<ol>
  <li>Download the CSV file to get the data.</li>
  <li>Change it to an GNU Octave script file.</li>
  <li>Open it using Vim.</li>
  <li>Do the necessary text substitutions so that the data becomes a
matrix.</li>
  <li>Complete the script file by adding the plot commands.
    <ul>
      <li><a href="https://www.gnu.org/software/octave/doc/interpreter/Two_002dDimensional-Plots.html">Line format arguments</a></li>
      <li><a href="http://stackoverflow.com/a/22822575/3184351">Add coordinates to points</a></li>
    </ul>
  </li>
</ol>

<p>{% include_code The source code for the log plot lang:octave mathse-rep.m %}</p>

<p>I choose <code>loglog</code> because <code>semilogx</code> causes the labels on tail to
overlap.  Here’s the results.</p>

<picture class="fancybox" title="Target log graph">
  <source srcset="/images/posts/MathSE/loglog1215.svg" media="(min-width: 800px)" />
  <img alt="Target log graph" width="300" src="https://vincenttam.github.io/images/posts/MathSE/loglog576.svg" />
</picture>

<h2 id="lessons-learnt">Lessons learnt</h2>

<p>I can save plots in GNU Octave as a SVG file.  I know this after
searching “octave export svg”.  From
<a href="https://www.gnu.org/software/octave/doc/interpreter/Printing-and-Saving-Plots.html"><em>Printing and Saving Plots</em></a>, I see <code>print -d[device]</code>,
in which one can substitute the output format.  For example, I used
<code>print -dsvg</code> to generate the SVG’s shown above.</p>

]]></content>
    
  </entry>
  
</feed>
